#[cfg(target_arch = "x86_64")]
use std::arch::x86_64::*;
use crate::field::fields::*;
use crate::ntt::transpose::*;

#[target_feature(enable = "avx2")]
pub unsafe fn intt_7681(s0: [__m256i;16]) -> [__m256i;16]{
    let s1 = intt5678_7681(s0);
    let s2 = transpose(s1);
    let s3 = intt1234_7681(s2);
    s3
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt1234_7681(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l1 ~ l4
    let l1:[__m256i;2] = [_mm256_set1_epi16(-3383), _mm256_set1_epi16(-28865)];
    let l2:[__m256i;4] = [_mm256_set1_epi16(1213), _mm256_set1_epi16(10350), _mm256_set1_epi16(1925), _mm256_set1_epi16(16425)];
    let l3:[__m256i;8] = [_mm256_set1_epi16(527), _mm256_set1_epi16(4496), _mm256_set1_epi16(849), _mm256_set1_epi16(7244), _mm256_set1_epi16(583), _mm256_set1_epi16(4974), _mm256_set1_epi16(1728), _mm256_set1_epi16(14744)];
    let l4:[__m256i;16] = [_mm256_set1_epi16(2784), _mm256_set1_epi16(23754), _mm256_set1_epi16(1366), _mm256_set1_epi16(11655), _mm256_set1_epi16(-2138), _mm256_set1_epi16(-18242), _mm256_set1_epi16(2648), _mm256_set1_epi16(22593), _mm256_set1_epi16(2381), _mm256_set1_epi16(20315), _mm256_set1_epi16(2446), _mm256_set1_epi16(20870), _mm256_set1_epi16(-97), _mm256_set1_epi16(-828), _mm256_set1_epi16(2132), _mm256_set1_epi16(18191)];

    // inverse Layer 4
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_7681(a[2*i], a[2*i+1], l4[2*i], l4[2*i+1]);
    }
    // inverse Layer 3
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_ibutterfly_7681(a0[i*4+j], a0[i*4+j+2], l3[2*i], l3[2*i+1]);
        }
    }
    // inverse Layer 2
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_ibutterfly_7681(a1[i], a1[i+4], l2[0], l2[1]);
        [a0[i+8], a0[i+12]] = barrett_ibutterfly_7681(a1[i+8], a1[i+12], l2[2], l2[3]);
    }
    // inverse Layer 1
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_ibutterfly_7681(a0[i], a0[i+8], l1[0], l1[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt5678_7681(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l5 ~ l8
    let l5:[__m256i;2] = [_mm256_set_epi16(-1846, 365, -2753, -3654, -2645, 330, 2273, 878, -3000, 2399, -1112, -1794, -2268, 675, 3092, 1286), _mm256_set_epi16(-15750, 3114, -23489, -31177, -22568, 2816, 19394, 7491, -25597, 20469, -9488, -15307, -19351, 5759, 26382, 10972)];
    let l6:[__m256i;4] = [_mm256_set_epi16(-766, 2881, 243, -202, 2516, -1080, -2551, -3411, 528, -3449, 2508, 2941, 1655, -584, -2774, -1740), _mm256_set_epi16(-6536, 24581, 2073, -1724, 21467, -9215, -21766, -29103, 4505, -29428, 21399, 25093, 14121, -4983, -23668, -14846), _mm256_set_epi16(3074, -732, 3477, -3080, -3380, -2469, -1714, 693, -2423, 1382, 1908, 2724, 1875, -1381, -695, -799), _mm256_set_epi16(26228, -6246, 29667, -26279, -28839, -21066, -14624, 5913, -20674, 11792, 16279, 23242, 15998, -11783, -5930, -6817)];
    let l7:[__m256i;8] = [_mm256_set_epi16(2044, 1952, 2028, -1591, 1097, 1228, -1848, 550, -2681, 1438, -707, -2990, 2593, -417, -3780, 1125), _mm256_set_epi16(17440, 16655, 17303, -13575, 9360, 10478, -15768, 4693, -22875, 12269, -6032, -25511, 22124, -3558, -32252, 9599), _mm256_set_epi16(-1408, 1044, -2722, 993, 3041, 2844, -1853, 1003, 1415, -1682, -3532, -2880, -3099, 648, -3078, 2562), _mm256_set_epi16(-12013, 8908, -23225, 8472, 25946, 24266, -15810, 8558, 12073, -14351, -30136, -24573, -26441, 5529, -26262, 21860), _mm256_set_epi16(-869, 1996, 1800, 1633, 3837, 319, -2897, 405, -3501, 219, -3188, -880, -2063, 2900, 198, -1587), _mm256_set_epi16(-7415, 17030, 15358, 13933, 32738, 2722, -24718, 3456, -29871, 1869, -27201, -7508, -17602, 24743, 1689, -13541), _mm256_set_epi16(-2819, 3125, 3789, -1402, 3180, 3141, 1478, -257, 3073, -3566, 2264, -1155, -2563, -1220, 2573, -1886), _mm256_set_epi16(-24052, 26663, 32329, -11962, 27132, 26800, 12611, -2193, 26220, -30426, 19317, -9855, -21868, -10409, 21953, -16092)];
    let l8:[__m256i;16] = [_mm256_set_epi16(2805, 3280, -118, 218, 329, -738, 3483, 335, 113, -1771, -1189, -2457, 3765, -1897, -3239, -3250), _mm256_set_epi16(23933, 27986, -1007, 1860, 2807, -6297, 29718, 2858, 964, -15111, -10145, -20964, 32124, -16186, -27636, -27730), _mm256_set_epi16(1036, -2252, 2760, 3016, -2811, 535, -621, 3751, 1115, -674, -3376, -639, -1872, 3832, 1211, -2840), _mm256_set_epi16(8839, -19215, 23549, 25733, -23984, 4565, -5299, 32004, 9513, -5751, -28805, -5452, -15972, 32695, 10333, -24232), _mm256_set_epi16(-1717, -1775, -1170, 2395, -1657, 1499, 2481, 2110, 536, 572, -2546, -2717, 1725, 1885, -2433, 3193), _mm256_set_epi16(-14650, -15145, -9983, 20435, -14138, 12790, 21168, 18003, 4573, 4880, -21723, -23182, 14718, 16083, -20759, 27243), _mm256_set_epi16(3137, -2671, -3086, -1459, 1784, -1994, 793, 2050, 111, 856, 1393, 3615, -2067, -2951, -3265, -217), _mm256_set_epi16(26766, -22790, -26330, -12449, 15221, -17013, 6766, 17491, 947, 7304, 11885, 30844, -17636, -25179, -27858, -1851), _mm256_set_epi16(185, 3694, -2799, 1656, 321, 2922, -3445, 2358, -669, -2668, 2583, -2689, -3799, -1704, -413, 763), _mm256_set_epi16(1578, 31518, -23882, 14129, 2739, 24931, -29394, 20119, -5708, -22764, 22039, -22943, -32414, -14539, -3524, 6510), _mm256_set_epi16(2875, -1979, -3626, 201, 1683, -1968, 1667, 1607, 62, -2359, -1604, -3546, 2259, -398, 1129, -1950), _mm256_set_epi16(24530, -16885, -30938, 1715, 14360, -16791, 14223, 13711, 529, -20128, -13686, -30255, 19274, -3396, 9633, -16638), _mm256_set_epi16(-2996, 3452, 1035, 1131, -3394, -1193, 94, 3081, 506, 1065, 702, -1437, -1266, -3120, 542, -2173), _mm256_set_epi16(-25563, 29453, 8831, 9650, -28958, -10179, 802, 26288, 4317, 9087, 5990, -12261, -10802, -26621, 4624, -18541), _mm256_set_epi16(-1406, 1959, 2838, 296, -2372, -2169, -3586, 3139, 346, 3006, 2757, 2197, -2002, -1876, -2012, -1230), _mm256_set_epi16(-11996, 16715, 24214, 2526, -20238, -18506, -30597, 26783, 2952, 25648, 23523, 18745, -17082, -16006, -17167, -10495)];

    // // inverse Layer 8
    // for i in 0..8{
    //     [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_7681(a[2*i], a[2*i+1], l8[2*i], l8[2*i+1]);
    // }
    // // inverse Layer 7
    // for i in 0..4{
    //     for j in 0..2{
    //         [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_7681(a0[i*4+j], a0[i*4+j+2], l7[2*i], l7[2*i+1]);
    //     }
    // }
    // // inverse Layer 6
    // for i in 0..4{
    //     [a0[i], a0[i+4]] = barrett_butterfly_7681(a1[i], a1[i+4], l6[0], l6[1]);
    //     [a0[i+8], a0[i+12]] = barrett_butterfly_7681(a1[i+8], a1[i+12], l6[2], l6[3]);
    // }
    // inverse Layer 5
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_7681(a[i], a[i+8], l5[0], l5[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt_10753(s0: [__m256i;16]) -> [__m256i;16]{
    let s1 = intt5678_10753(s0);
    let s2 = transpose(s1);
    let s3 = intt1234_10753(s2);
    s3
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt1234_10753(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l1 ~ l4
    let l1:[__m256i;2] = [_mm256_set1_epi16(-4489), _mm256_set1_epi16(-27359)];
    let l2:[__m256i;4] = [_mm256_set1_epi16(321), _mm256_set1_epi16(1956), _mm256_set1_epi16(67), _mm256_set1_epi16(408)];
    let l3:[__m256i;8] = [_mm256_set1_epi16(3422), _mm256_set1_epi16(20856), _mm256_set1_epi16(4679), _mm256_set1_epi16(28517), _mm256_set1_epi16(1656), _mm256_set1_epi16(10093), _mm256_set1_epi16(3461), _mm256_set1_epi16(21094)];
    let l4:[__m256i;16] = [_mm256_set1_epi16(2640), _mm256_set1_epi16(16090), _mm256_set1_epi16(-1154), _mm256_set1_epi16(-7033), _mm256_set1_epi16(-4832), _mm256_set1_epi16(-29449), _mm256_set1_epi16(2047), _mm256_set1_epi16(12476), _mm256_set1_epi16(1560), _mm256_set1_epi16(9508), _mm256_set1_epi16(-2637), _mm256_set1_epi16(-16072), _mm256_set1_epi16(-4631), _mm256_set1_epi16(-28224), _mm256_set1_epi16(3010), _mm256_set1_epi16(18345)];

    // inverse Layer 4
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_10753(a[2*i], a[2*i+1], l4[2*i], l4[2*i+1]);
    }
    // inverse Layer 3
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_10753(a0[i*4+j], a0[i*4+j+2], l3[2*i], l3[2*i+1]);
        }
    }
    // inverse Layer 2
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_10753(a1[i], a1[i+4], l2[0], l2[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_10753(a1[i+8], a1[i+12], l2[2], l2[3]);
    }
    // inverse Layer 1
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_10753(a0[i], a0[i+8], l1[0], l1[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt5678_10753(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l5 ~ l8
    let l5:[__m256i;2] = [_mm256_set_epi16(1186, 1219, -4351, 4191, -3783, -2900, -746, -4611, 136, 2417, 644, -1641, -1917, -3013, -2436, -597), _mm256_set_epi16(7228, 7429, -26518, 25543, -23056, -17675, -4547, -28103, 829, 14731, 3925, -10001, -11683, -18363, -14847, -3639)];
    let l6:[__m256i;4] = [_mm256_set_epi16(2582, 1136, -841, 946, 3902, -559, -3362, -5194, 2599, 94, 2085, 4455, -2744, 5122, -922, -1047), _mm256_set_epi16(15736, 6924, -5126, 5766, 23781, -3407, -20490, -31656, 15840, 573, 12707, 27152, -16724, 31217, -5619, -6381), _mm256_set_epi16(2353, 3171, -3644, 2603, -3712, -3982, 2031, -1385, 3314, 5147, 3775, 753, 3697, -3954, -380, -3907), _mm256_set_epi16(14341, 19326, -22209, 15864, -22623, -24269, 12378, -8441, 20198, 31369, 23007, 4589, 22532, -24098, -2316, -23812)];
    let l7:[__m256i;8] = [_mm256_set_epi16(-1828, -1353, -4627, 4193, 2830, -4577, 3944, -5178, -1924, -2177, -128, 4683, -2857, 3256, -3092, 2135), _mm256_set_epi16(-11141, -8246, -28200, 25555, 17248, -27895, 24037, -31558, -11726, -13268, -780, 28541, -17412, 19844, -18845, 13012), _mm256_set_epi16(4098, -2461, -3592, 5012, 29, 1145, 1444, 1943, 2228, 1202, -1266, -5263, 5155, -339, 1207, -1289), _mm256_set_epi16(24976, -14999, -21892, 30546, 177, 6978, 8801, 11842, 13579, 7326, -7716, -32076, 31418, -2066, 7356, -7856), _mm256_set_epi16(5232, -1896, 4305, -2004, -4053, 159, -100, -2726, -84, 721, -5295, -5125, 4825, -2883, 393, -685), _mm256_set_epi16(31887, -11555, 26238, -12214, -24702, 969, -609, -16614, -512, 4394, -32271, -31235, 29407, -17571, 2395, -4175), _mm256_set_epi16(2847, -5134, -2805, 118, 216, 1854, 4818, 3719, -317, 3617, -4980, 267, 1945, 331, -1279, -671), _mm256_set_epi16(17352, -31290, -17096, 719, 1316, 11300, 29364, 22666, -1932, 22044, -30351, 1627, 11854, 2017, -7795, -4090)];
    let l8:[__m256i;16] = [_mm256_set_epi16(-697, 290, 3687, 2076, -3104, -2032, -3645, 3661, -2215, -3390, -2137, 1317, 1267, -774, -1135, -1907), _mm256_set_epi16(-4248, 1767, 22471, 12653, -18918, -12384, -22215, 22313, -13500, -20661, -13024, 8027, 7722, -4717, -6917, -11623), _mm256_set_epi16(2777, 3226, 3258, 1082, -1985, 3572, 3959, -2758, -1339, 156, -301, -3689, 3818, -1280, 264, -2266), _mm256_set_epi16(16925, 19661, 19856, 6594, -12098, 21770, 24129, -16809, -8161, 951, -1834, -22483, 23269, -7801, 1609, -13811), _mm256_set_epi16(5168, -4931, -2160, 2966, -3789, 2425, -1180, -4209, 3170, 3911, -3965, -2670, -3310, -2056, -4043, 2037), _mm256_set_epi16(31497, -30053, -13164, 18077, -23093, 14780, -7192, -25652, 19320, 23836, -24165, -16273, -20173, -12531, -24641, 12415), _mm256_set_epi16(-840, 3543, 2515, 815, -3930, 3903, -5238, -3429, -1000, -4999, 2482, -1590, 1466, 38, 2546, -1445), _mm256_set_epi16(-5120, 21593, 15328, 4967, -23952, 23788, -31924, -20899, -6095, -30467, 15127, -9691, 8935, 232, 15517, -8807), _mm256_set_epi16(-1360, -2664, -4313, 5096, 2854, 4783, 2336, -2129, -3098, -3293, -5182, 3259, -1107, 1437, -498, -1102), _mm256_set_epi16(-8289, -16236, -26286, 31058, 17394, 29151, 14237, -12976, -18881, -20070, -31583, 19863, -6747, 8758, -3035, -6716), _mm256_set_epi16(3298, -2159, -4864, 4847, -787, 4894, -5308, -1036, 3778, -1961, 4946, -2351, 10, 1878, 3210, 670), _mm256_set_epi16(20100, -13158, -29644, 29541, -4797, 29827, -32351, -6314, 23026, -11952, 30144, -14329, 61, 11446, 19564, 4083), _mm256_set_epi16(549, -2024, -4181, -4524, -4861, -3192, 3097, 1196, 2295, -881, -5262, 3223, -3942, -3800, 3472, -4711), _mm256_set_epi16(3346, -12336, -25482, -27572, -29626, -19454, 18875, 7289, 13987, -5369, -32070, 19643, -24025, -23160, 21161, -28712), _mm256_set_epi16(-4314, 607, 1293, 2343, 1361, -1825, -5163, -3992, 1538, -656, -4484, -940, 1533, 283, 4819, -2545), _mm256_set_epi16(-26292, 3699, 7880, 14280, 8295, -11123, -31467, -24330, 9374, -3998, -27329, -5729, 9343, 1725, 29370, -15511)];

    // inverse Layer 8
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_10753(a[2*i], a[2*i+1], l8[2*i], l8[2*i+1]);
    }
    // inverse Layer 7
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_10753(a0[i*4+j], a0[i*4+j+2], l7[2*i], l7[2*i+1]);
        }
    }
    // inverse Layer 6
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_10753(a1[i], a1[i+4], l6[0], l6[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_10753(a1[i+8], a1[i+12], l6[2], l6[3]);
    }
    // inverse Layer 5
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_10753(a0[i], a0[i+8], l5[0], l5[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt_11777(s0: [__m256i;16]) -> [__m256i;16]{
    let s1 = intt5678_11777(s0);
    let s2 = transpose(s1);
    let s3 = intt1234_11777(s2);
    s3
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt1234_11777(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l1 ~ l4
    let l1:[__m256i;2] = [_mm256_set1_epi16(-5322), _mm256_set1_epi16(-29616)];
    let l2:[__m256i;4] = [_mm256_set1_epi16(4201), _mm256_set1_epi16(23377), _mm256_set1_epi16(4976), _mm256_set1_epi16(27690)];
    let l3:[__m256i;8] = [_mm256_set1_epi16(-2497), _mm256_set1_epi16(-13895), _mm256_set1_epi16(-4578), _mm256_set1_epi16(-25475), _mm256_set1_epi16(-3410), _mm256_set1_epi16(-18976), _mm256_set1_epi16(-337), _mm256_set1_epi16(-1875)];
    let l4:[__m256i;16] = [_mm256_set1_epi16(-293), _mm256_set1_epi16(-1630), _mm256_set1_epi16(-4782), _mm256_set1_epi16(-26611), _mm256_set1_epi16(5692), _mm256_set1_epi16(31675), _mm256_set1_epi16(2380), _mm256_set1_epi16(13244), _mm256_set1_epi16(-1224), _mm256_set1_epi16(-6811), _mm256_set1_epi16(-1447), _mm256_set1_epi16(-8052), _mm256_set1_epi16(1915), _mm256_set1_epi16(10656), _mm256_set1_epi16(4525), _mm256_set1_epi16(25180)];

    // inverse Layer 4
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_11777(a[2*i], a[2*i+1], l4[2*i], l4[2*i+1]);
    }
    // inverse Layer 3
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_11777(a0[i*4+j], a0[i*4+j+2], l3[2*i], l3[2*i+1]);
        }
    }
    // inverse Layer 2
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_11777(a1[i], a1[i+4], l2[0], l2[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_11777(a1[i+8], a1[i+12], l2[2], l2[3]);
    }
    // inverse Layer 1
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_11777(a0[i], a0[i+8], l1[0], l1[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt5678_11777(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l5 ~ l8
    let l5:[__m256i;2] = [_mm256_set_epi16(-3587, 503, -5020, 5573, -4148, 5558, -4633, 4212, -3268, 2333, -2469, 3114, 2838, -5722, 1265, -4114), _mm256_set_epi16(-19961, 2799, -27935, 31012, -23083, 30929, -25781, 23439, -18186, 12983, -13739, 17329, 15793, -31841, 7039, -22893)];
    let l6:[__m256i;4] = [_mm256_set_epi16(-3679, -5513, -5246, -4055, 1352, -403, -2885, 3238, -1860, 5537, 5709, -1362, 4282, -309, -2639, -5203), _mm256_set_epi16(-20473, -30678, -29193, -22565, 7524, -2243, -16054, 18019, -10350, 30812, 31769, -7579, 23828, -1720, -14685, -28953), _mm256_set_epi16(-3010, 2500, -2584, 3488, -690, -2244, -5444, -1548, -5197, -5739, 1961, -2020, -2326, 1345, -2615, 3384), _mm256_set_epi16(-16750, 13912, -14379, 19410, -3840, -12487, -30294, -8614, -28920, -31936, 10912, -11241, -12944, 7485, -14552, 18831)];
    let l7:[__m256i;8] = [_mm256_set_epi16(-3834, -4993, -756, 4302, 3412, -1470, 4322, -1203, -831, 5570, -5039, -1329, -347, -2255, 2601, -4547), _mm256_set_epi16(-21335, -27785, -4207, 23940, 18987, -8180, 24051, -6694, -4624, 30996, -28041, -7396, -1931, -12548, 14474, -25303), _mm256_set_epi16(2403, 1056, 2114, 3673, -5798, 1216, 2562, 2802, 3404, -3062, -2978, -2926, 2541, 3206, -4482, 4779), _mm256_set_epi16(13372, 5876, 11764, 20439, -32264, 6767, 14257, 15592, 18942, -17039, -16572, -16282, 14140, 17841, -24941, 26594), _mm256_set_epi16(-5680, 2599, -1478, -1120, -4365, 5491, -576, -3452, -4748, 4586, 3890, -1386, -3998, -3683, -2695, 1596), _mm256_set_epi16(-31608, 14463, -8225, -6233, -24290, 30556, -3205, -19209, -26421, 25520, 21647, -7713, -22248, -20495, -14997, 8881), _mm256_set_epi16(-1936, -1483, 4771, -50, 5073, 5622, -5137, 4697, 2315, 1688, 2487, 1534, 1230, -1952, 3560, 2873), _mm256_set_epi16(-10773, -8253, 26549, -278, 28230, 31285, -28586, 26138, 12882, 9393, 13840, 8536, 6845, -10862, 19810, 15988)];
    let l8:[__m256i;16] = [_mm256_set_epi16(-3449, 4765, 3135, 3539, -4133, 3610, 3166, 3435, -2062, 2200, 5410, 2745, 551, 51, 5318, 2265), _mm256_set_epi16(-19193, 26516, 17445, 19694, -22999, 20089, 17618, 19115, -11475, 12242, 30105, 15275, 3066, 284, 29593, 12604), _mm256_set_epi16(-2603, -3414, -5630, 2172, 1790, -1213, 3628, 5713, 810, -438, 2826, 743, -1575, 3074, -2099, 5495), _mm256_set_epi16(-14485, -18998, -31330, 12087, 9961, -6750, 20189, 31791, 4507, -2437, 15726, 4135, -8764, 17106, -11680, 30578), _mm256_set_epi16(3001, -1710, 5811, 260, -5181, -3325, -1485, 803, 261, 644, 3266, -1200, 3982, 5381, 5042, -5518), _mm256_set_epi16(16700, -9516, 32337, 1447, -28831, -18503, -8264, 4468, 1452, 3584, 18174, -6678, 22159, 29944, 28057, -30706), _mm256_set_epi16(2047, 409, -2237, 1233, -3491, 5004, 141, -3326, 5795, -2973, -1736, 5824, -2067, -856, -3818, -4071), _mm256_set_epi16(11391, 2276, -12448, 6861, -19427, 27846, 785, -18508, 32248, -16544, -9660, 32409, -11502, -4763, -21246, -22654), _mm256_set_epi16(4205, -2710, -3649, 295, 5336, -3845, 5199, 4905, 4007, -2893, -4074, -371, -4971, 4520, 3996, 2550), _mm256_set_epi16(23400, -15080, -20306, 1642, 29693, -21396, 28931, 27295, 22298, -16099, -22671, -2065, -27662, 25153, 22237, 14190), _mm256_set_epi16(4716, 1765, 4745, 3002, 5822, 603, 2607, -1148, 1043, -3879, 3689, 599, 24, 1819, 1654, -5169), _mm256_set_epi16(26243, 9822, 26405, 16705, 32398, 3356, 14507, -6388, 5804, -21586, 20528, 3333, 134, 10122, 9204, -28764), _mm256_set_epi16(3341, -2468, -4308, 2643, -4675, 4451, 4361, 3225, -3643, 3104, -2765, 5857, -1422, -4727, -2883, -2105), _mm256_set_epi16(18592, -13734, -23973, 14708, -26015, 24769, 24268, 17946, -20272, 17273, -15387, 32593, -7913, -26305, -16043, -11714), _mm256_set_epi16(44, -1372, -3588, -4819, 3061, -3051, 1223, 3875, 1821, -1109, 4783, 5029, 1578, 1115, 1273, -3131), _mm256_set_epi16(245, -7635, -19966, -26817, 17034, -16978, 6806, 21563, 10133, -6171, 26616, 27985, 8781, 6205, 7084, -17423)];

    // inverse Layer 8
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_11777(a[2*i], a[2*i+1], l8[2*i], l8[2*i+1]);
    }
    // inverse Layer 7
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_11777(a0[i*4+j], a0[i*4+j+2], l7[2*i], l7[2*i+1]);
        }
    }
    // inverse Layer 6
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_11777(a1[i], a1[i+4], l6[0], l6[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_11777(a1[i+8], a1[i+12], l6[2], l6[3]);
    }
    // inverse Layer 5
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_11777(a0[i], a0[i+8], l5[0], l5[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt_12289(s0: [__m256i;16]) -> [__m256i;16]{
    let s1 = intt5678_12289(s0);
    let s2 = transpose(s1);
    let s3 = intt1234_12289(s2);
    s3
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt1234_12289(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l1 ~ l4
    let l1:[__m256i;2] = [_mm256_set1_epi16(-1479), _mm256_set1_epi16(-7887)];
    let l2:[__m256i;4] = [_mm256_set1_epi16(5146), _mm256_set1_epi16(27443), _mm256_set1_epi16(4043), _mm256_set1_epi16(21561)];
    let l3:[__m256i;8] = [_mm256_set1_epi16(-5736), _mm256_set1_epi16(-30590), _mm256_set1_epi16(-4134), _mm256_set1_epi16(-22046), _mm256_set1_epi16(-722), _mm256_set1_epi16(-3850), _mm256_set1_epi16(-1305), _mm256_set1_epi16(-6959)];
    let l4:[__m256i;16] = [_mm256_set1_epi16(2545), _mm256_set1_epi16(13572), _mm256_set1_epi16(3621), _mm256_set1_epi16(19310), _mm256_set1_epi16(3504), _mm256_set1_epi16(18686), _mm256_set1_epi16(-3542), _mm256_set1_epi16(-18889), _mm256_set1_epi16(1646), _mm256_set1_epi16(8778), _mm256_set1_epi16(1212), _mm256_set1_epi16(6463), _mm256_set1_epi16(-5860), _mm256_set1_epi16(-31251), _mm256_set1_epi16(3195), _mm256_set1_epi16(17039)];

    // inverse Layer 4
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_12289(a[2*i], a[2*i+1], l4[2*i], l4[2*i+1]);
    }
    // inverse Layer 3
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_12289(a0[i*4+j], a0[i*4+j+2], l3[2*i], l3[2*i+1]);
        }
    }
    // inverse Layer 2
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_12289(a1[i], a1[i+4], l2[0], l2[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_12289(a1[i+8], a1[i+12], l2[2], l2[3]);
    }
    // inverse Layer 1
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_12289(a0[i], a0[i+8], l1[0], l1[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt5678_12289(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l5 ~ l8
    let l5:[__m256i;2] = [_mm256_set_epi16(-2625, -949, 2639, 4821, 563, 2975, 2744, -3006, 1351, 4978, -5777, -3328, 5728, -4591, 5828, 5023), _mm256_set_epi16(-13999, -5061, 14074, 25710, 3002, 15865, 14633, -16031, 7205, 26547, -30808, -17748, 30547, -24483, 31080, 26787)];
    let l6:[__m256i;4] = [_mm256_set_epi16(726, -4611, -140, -1853, -2768, 1635, 4255, -1177, -81, 3091, 1000, -4320, -2366, -3051, -4896, 2963), _mm256_set_epi16(3872, -24590, -747, -9882, -14761, 8719, 22691, -6277, -432, 16484, 5333, -23038, -12618, -16271, -26110, 15801), _mm256_set_epi16(3014, -3201, -1326, 5086, -790, -955, 2319, -1170, -4846, -2747, -3135, 3712, -1062, 2294, -3553, 4805), _mm256_set_epi16(16073, -17071, -7071, 27123, -4213, -5093, 12367, -6239, -25843, -14649, -16719, 19796, -5664, 12234, -18948, 25625)];
    let l7:[__m256i;8] = [_mm256_set_epi16(9, 1022, 480, -2842, -5791, -544, -339, -2468, 1381, -2525, -3584, -4177, 4989, -5331, -1673, 4278), _mm256_set_epi16(48, 5450, 2560, -15156, -30883, -2901, -1808, -13162, 7365, -13466, -19113, -22276, 26606, -28430, -8922, 22814), _mm256_set_epi16(-2837, 5374, -130, -4354, 3296, -3949, -2396, -4452, 5067, 2197, -2476, -118, -827, -5767, -3748, -953), _mm256_set_epi16(-15129, 28659, -693, -23219, 17577, -21060, -12778, -23742, 27022, 11716, -13204, -629, -4410, -30755, -19988, -5082), _mm256_set_epi16(-3694, 5179, -3707, -1759, -355, 3382, -4231, 2548, 3932, 2731, 4890, -5911, -5542, -145, -3459, -3637), _mm256_set_epi16(-19700, 27619, -19769, -9381, -1893, 18036, -22563, 13588, 20969, 14564, 26078, -31523, -29555, -773, -18446, -19396), _mm256_set_epi16(-3241, -729, 3289, 2013, -2089, -5092, -3284, -2881, -1696, 1428, -334, -2426, -4388, 1260, -5755, -4632), _mm256_set_epi16(-17284, -3888, 17540, 10735, -11140, -27155, -17513, -15364, -9045, 7615, -1781, -12938, -23401, 6719, -30691, -24702)];
    let l8:[__m256i;16] = [_mm256_set_epi16(2780, 5195, -1484, 4895, 2645, 4053, -2305, -5042, -2174, 4372, 4414, 2847, 1689, 3364, -3271, 4057), _mm256_set_epi16(14825, 27704, -7914, 26105, 14106, 21614, -12292, -26888, -11594, 23315, 23539, 15183, 9007, 17940, -17444, 21636), _mm256_set_epi16(-4437, -3, 3149, 160, -4919, -113, -3915, -2166, -1426, -4654, -1663, -1777, -5291, -2704, 4938, -3636), _mm256_set_epi16(-23662, -16, 16793, 853, -26233, -603, -20878, -11551, -7605, -24819, -8869, -9477, -28216, -14420, 26334, -19390), _mm256_set_epi16(-2249, 4048, 2884, -1153, 1630, -2126, 5407, -3186, -2370, -2865, -5332, -3510, -2969, 3978, 2686, -3247), _mm256_set_epi16(-11994, 21588, 15380, -6149, 8693, -11338, 28835, -16991, -12639, -15279, -28435, -18718, -15833, 21214, 14324, -17316), _mm256_set_epi16(3985, 4905, -3531, -476, 2178, -1544, 420, 5559, -5191, 3136, -2399, 3400, -3016, -243, 3000, 671), _mm256_set_epi16(21252, 26158, -18830, -2538, 11615, -8234, 2240, 29646, -27683, 16724, -12794, 18132, -16084, -1296, 15999, 3578), _mm256_set_epi16(5444, 2381, -493, -4096, -4337, -435, -1912, -1378, -3248, 1207, -1168, -5277, -404, -4645, -1065, -2143), _mm256_set_epi16(29032, 12698, -2629, -21844, -23129, -2320, -10197, -7349, -17321, 6437, -6229, -28142, -2154, -24771, -5680, -11428), _mm256_set_epi16(5011, -1002, 5088, 4284, -875, -3780, 1607, 4976, 2987, 6022, -3646, 2437, 2422, 6039, -2566, 2187), _mm256_set_epi16(26723, -5344, 27134, 22846, -4666, -20158, 8570, 26537, 15929, 32115, -19444, 12996, 12916, 32205, -13684, 11663), _mm256_set_epi16(2859, -1045, -2481, 5012, 2912, 5698, -354, -4861, 5101, 1067, -442, -2401, 3778, 3833, -390, 773), _mm256_set_epi16(15247, -5573, -13231, 26728, 15529, 30387, -1888, -25923, 27203, 5690, -2357, -12804, 20148, 20441, -2080, 4122), _mm256_set_epi16(-3763, 1440, -27, 3066, 1632, -5084, -4885, 1017, -545, 5019, 3704, -2678, -4714, -4143, -1537, -242), _mm256_set_epi16(-20068, 7679, -144, 16351, 8703, -27112, -26051, 5424, -2906, 26766, 19753, -14282, -25139, -22094, -8197, -1291)];

    // inverse Layer 8
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_12289(a[2*i], a[2*i+1], l8[2*i], l8[2*i+1]);
    }
    // inverse Layer 7
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_12289(a0[i*4+j], a0[i*4+j+2], l7[2*i], l7[2*i+1]);
        }
    }
    // inverse Layer 6
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_12289(a1[i], a1[i+4], l6[0], l6[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_12289(a1[i+8], a1[i+12], l6[2], l6[3]);
    }
    // inverse Layer 5
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_12289(a0[i], a0[i+8], l5[0], l5[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt_13313(s0: [__m256i;16]) -> [__m256i;16]{
    let s1 = intt5678_13313(s0);
    let s2 = transpose(s1);
    let s3 = intt1234_13313(s2);
    s3
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt1234_13313(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l1 ~ l4
    let l1:[__m256i;2] = [_mm256_set1_epi16(-258), _mm256_set1_epi16(-1270)];
    let l2:[__m256i;4] = [_mm256_set1_epi16(-2626), _mm256_set1_epi16(-12927), _mm256_set1_epi16(-1455), _mm256_set1_epi16(-7163)];
    let l3:[__m256i;8] = [_mm256_set1_epi16(-5275), _mm256_set1_epi16(-25967), _mm256_set1_epi16(3024), _mm256_set1_epi16(14886), _mm256_set1_epi16(6476), _mm256_set1_epi16(31879), _mm256_set1_epi16(-6630), _mm256_set1_epi16(-32638)];
    let l4:[__m256i;16] = [_mm256_set1_epi16(4196), _mm256_set1_epi16(20656), _mm256_set1_epi16(4215), _mm256_set1_epi16(20749), _mm256_set1_epi16(5487), _mm256_set1_epi16(27011), _mm256_set1_epi16(4468), _mm256_set1_epi16(21995), _mm256_set1_epi16(4690), _mm256_set1_epi16(23087), _mm256_set1_epi16(1463), _mm256_set1_epi16(7202), _mm256_set1_epi16(1415), _mm256_set1_epi16(6966), _mm256_set1_epi16(5619), _mm256_set1_epi16(27661)];

    // inverse Layer 4
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_13313(a[2*i], a[2*i+1], l4[2*i], l4[2*i+1]);
    }
    // inverse Layer 3
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_13313(a0[i*4+j], a0[i*4+j+2], l3[2*i], l3[2*i+1]);
        }
    }
    // inverse Layer 2
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_13313(a1[i], a1[i+4], l2[0], l2[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_13313(a1[i+8], a1[i+12], l2[2], l2[3]);
    }
    // inverse Layer 1
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_13313(a0[i], a0[i+8], l1[0], l1[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt5678_13313(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l5 ~ l8
    let l5:[__m256i;2] = [_mm256_set_epi16(-1152, -4330, 1278, -3101, 3902, 5072, -4358, 6072, 2651, 4995, -3565, 1173, 2198, -5375, -2970, -5894), _mm256_set_epi16(-5671, -21315, 6291, -15265, 19208, 24968, -21453, 29891, 13050, 24589, -17549, 5774, 10820, -26460, -14620, -29014)];
    let l6:[__m256i;4] = [_mm256_set_epi16(-1454, 2368, -1197, -2627, -1562, 3606, -1408, 3813, -3004, 2878, -4156, 6105, 4630, 3630, -3611, 272), _mm256_set_epi16(-7158, 11657, -5892, -12932, -7689, 17751, -6931, 18770, -14788, 14168, -20459, 30053, 22792, 17869, -17776, 1339), _mm256_set_epi16(1478, 4753, 6216, -6168, -4968, 3696, 519, -772, -2170, 714, -456, -2169, 5608, -4253, -2430, 1229), _mm256_set_epi16(7276, 23398, 30600, -30363, -24456, 18194, 2555, -3800, -10682, 3515, -2245, -10677, 27607, -20936, -11962, 6050)];
    let l7:[__m256i;8] = [_mm256_set_epi16(5150, 2600, -2108, -1969, 5583, 2610, -2335, 3345, 708, 3718, -4612, 5039, 5449, 5336, 6253, 2401), _mm256_set_epi16(25352, 12799, -10377, -9693, 27483, 12848, -11495, 16466, 3485, 18303, -22704, 24806, 26824, 26268, 30782, 11819), _mm256_set_epi16(-1437, -2018, 5983, 694, 5450, -5078, 4798, -225, 3534, -6488, -1123, -3152, 1137, -460, 3650, 3523), _mm256_set_epi16(-7074, -9934, 29453, 3416, 26829, -24998, 23619, -1108, 17397, -31939, -5528, -15516, 5597, -2264, 17968, 17343), _mm256_set_epi16(-917, -3048, 1611, 2935, -894, 4331, -4556, 3904, -735, -3248, -4385, 275, -492, 6194, 631, 3042), _mm256_set_epi16(-4514, -15004, 7930, 14448, -4401, 21320, -22428, 19218, -3618, -15989, -21586, 1354, -2422, 30491, 3106, 14975), _mm256_set_epi16(-280, 5675, 3065, 5303, 5312, 743, 2712, 5893, 3190, 2386, -3063, -4787, -382, 5365, 4657, 3336), _mm256_set_epi16(-1378, 27936, 15088, 26105, 26149, 3658, 13350, 29010, 15703, 11746, -15078, -23565, -1880, 26410, 22925, 16422)];
    let l8:[__m256i;16] = [_mm256_set_epi16(-2603, -5924, 5909, 6473, -2770, 4242, -5122, 3489, -1733, -5528, 2188, 5358, -4730, -4456, -671, -49), _mm256_set_epi16(-12814, -29162, 29088, 31865, -13636, 20882, -25214, 17175, -8531, -27213, 10771, 26376, -23284, -21936, -3303, -241), _mm256_set_epi16(913, 4080, -1198, 2885, 1616, 4225, 3231, 5121, -4642, -534, 4419, -4816, 5506, 3943, 838, -3196), _mm256_set_epi16(4494, 20085, -5897, 14202, 7955, 20798, 15905, 25209, -22851, -2629, 21753, -23708, 27104, 19410, 4125, -15733), _mm256_set_epi16(2111, -1195, -5278, -3798, -3967, 1615, -6576, -5857, 747, -6344, -4611, -4781, 4953, 174, 223, 4282), _mm256_set_epi16(10392, -5883, -25982, -18696, -19528, 7950, -32372, -28832, 3677, -31230, -22699, -23535, 24382, 857, 1098, 21079), _mm256_set_epi16(3785, -4681, -5401, -4407, -455, -2427, -3340, 3625, 753, -5421, -3949, 6259, 549, -4801, -15, 3870), _mm256_set_epi16(18632, -23043, -26588, -21694, -2240, -11947, -16442, 17845, 3707, -26686, -19440, 30811, 2703, -23634, -74, 19051), _mm256_set_epi16(2168, -198, -741, -4796, -333, -6036, 5247, -4200, -4149, -5402, 6006, -5240, 3212, 3290, 597, 5730), _mm256_set_epi16(10672, -975, -3648, -23609, -1639, -29713, 25829, -20675, -20424, -26592, 29566, -25795, 15812, 16196, 2939, 28207), _mm256_set_epi16(-5933, -281, -3848, 5691, -790, -4125, -4532, 2288, 4086, -2461, 442, -5781, 5308, -1775, 97, -1600), _mm256_set_epi16(-29206, -1383, -18943, 28015, -3889, -20306, -22310, 11263, 20114, -12115, 2176, -28458, 26130, -8738, 478, -7876), _mm256_set_epi16(-789, 3867, 4914, 3077, 939, 2628, 4994, 2909, 1857, 162, 3924, -604, 2615, -4293, -2693, -2518), _mm256_set_epi16(-3884, 19036, 24190, 15147, 4622, 12937, 24584, 14320, 9141, 797, 19317, -2973, 12873, -21133, -13257, -12395), _mm256_set_epi16(2903, -3446, -5071, 3644, -3708, -1872, 3375, 5405, -4129, -242, -5972, -3532, 3742, 6413, -1498, -407), _mm256_set_epi16(14291, -16964, -24963, 17938, -18253, -9215, 16614, 26607, -20326, -1191, -29398, -17387, 18421, 31569, -7374, -2004)];

    // inverse Layer 8
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_13313(a[2*i], a[2*i+1], l8[2*i], l8[2*i+1]);
    }
    // inverse Layer 7
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_13313(a0[i*4+j], a0[i*4+j+2], l7[2*i], l7[2*i+1]);
        }
    }
    // inverse Layer 6
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_13313(a1[i], a1[i+4], l6[0], l6[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_13313(a1[i+8], a1[i+12], l6[2], l6[3]);
    }
    // inverse Layer 5
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_13313(a0[i], a0[i+8], l5[0], l5[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt_15361(s0: [__m256i;16]) -> [__m256i;16]{
    let s1 = intt5678_15361(s0);
    let s2 = transpose(s1);
    let s3 = intt1234_15361(s2);
    s3
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt1234_15361(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l1 ~ l4
    let l1:[__m256i;2] = [_mm256_set1_epi16(-3968), _mm256_set1_epi16(-16929)];
    let l2:[__m256i;4] = [_mm256_set1_epi16(4309), _mm256_set1_epi16(18384), _mm256_set1_epi16(1319), _mm256_set1_epi16(5627)];
    let l3:[__m256i;8] = [_mm256_set1_epi16(179), _mm256_set1_epi16(764), _mm256_set1_epi16(-3666), _mm256_set1_epi16(-15641), _mm256_set1_epi16(3261), _mm256_set1_epi16(13913), _mm256_set1_epi16(-5686), _mm256_set1_epi16(-24259)];
    let l4:[__m256i;16] = [_mm256_set1_epi16(6372), _mm256_set1_epi16(27185), _mm256_set1_epi16(-110), _mm256_set1_epi16(-469), _mm256_set1_epi16(-2201), _mm256_set1_epi16(-9390), _mm256_set1_epi16(-6841), _mm256_set1_epi16(-29186), _mm256_set1_epi16(3874), _mm256_set1_epi16(16528), _mm256_set1_epi16(-4329), _mm256_set1_epi16(-18469), _mm256_set1_epi16(-5407), _mm256_set1_epi16(-23068), _mm256_set1_epi16(-4341), _mm256_set1_epi16(-18520)];

    // inverse Layer 4
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_15361(a[2*i], a[2*i+1], l4[2*i], l4[2*i+1]);
    }
    // inverse Layer 3
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_15361(a0[i*4+j], a0[i*4+j+2], l3[2*i], l3[2*i+1]);
        }
    }
    // inverse Layer 2
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_15361(a1[i], a1[i+4], l2[0], l2[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_15361(a1[i+8], a1[i+12], l2[2], l2[3]);
    }
    // inverse Layer 1
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_15361(a0[i], a0[i+8], l1[0], l1[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt5678_15361(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l5 ~ l8
    let l5:[__m256i;2] = [_mm256_set_epi16(-6422, -1403, 7237, 6707, -5361, 2537, 5099, 2395, 2572, 5992, -7467, -2313, 442, -2702, 720, 186), _mm256_set_epi16(-27399, -5986, 30876, 28615, -22872, 10824, 21754, 10218, 10973, 25564, -31857, -9868, 1886, -11528, 3072, 794)];
    let l6:[__m256i;4] = [_mm256_set_epi16(-2987, 6276, 7437, 1535, -5184, 1733, -2962, 2051, 3239, -4805, -6298, 1883, -121, -3937, 885, -5989), _mm256_set_epi16(-12744, 26776, 31729, 6549, -22117, 7394, -12637, 8750, 13819, -20500, -26870, 8034, -516, -16797, 3776, -25551), _mm256_set_epi16(7145, -5046, 4361, -7399, 3375, 2792, -3065, 3992, 2586, -100, 792, -6349, -2539, -2064, 243, -3519), _mm256_set_epi16(30483, -21528, 18606, -31567, 14399, 11912, -13076, 17031, 11033, -427, 3379, -27087, -10832, -8806, 1037, -15013)];
    let l7:[__m256i;8] = [_mm256_set_epi16(6511, 1554, -1210, -6713, 3469, -1536, -1967, -1668, 11, 2435, -852, -1316, -5149, 1102, -1969, -5757), _mm256_set_epi16(27778, 6630, -5162, -28640, 14800, -6553, -8392, -7116, 47, 10389, -3635, -5615, -21968, 4702, -8401, -24562), _mm256_set_epi16(-5279, -5332, -4468, -2430, 2046, -7441, 4862, -1000, 72, -6163, 3028, 2802, 4377, 5355, -2815, 2473), _mm256_set_epi16(-22522, -22748, -19062, -10367, 8729, -31746, 20743, -4266, 307, -26294, 12919, 11954, 18674, 22847, -12010, 10551), _mm256_set_epi16(-2171, -2993, -10, 6403, 4584, 1888, -5938, -1790, 7343, 2793, -2673, -7374, -6966, 6649, -2276, -1100), _mm256_set_epi16(-9262, -12769, -43, 27318, 19557, 8055, -25334, -7637, 31328, 11916, -11404, -31460, -29720, 28367, -9710, -4693), _mm256_set_epi16(-5626, 4435, 1331, 2776, 5352, 7527, -6772, 4907, 7200, -1860, 4420, -3702, -1524, -5002, -2135, -7592), _mm256_set_epi16(-24003, 18921, 5679, 11843, 22834, 32113, -28892, 20935, 30718, -7935, 18857, -15794, -6502, -21340, -9109, -32390)];
    let l8:[__m256i;16] = [_mm256_set_epi16(-644, -5466, -5345, -4581, -7612, 4690, 5866, -4373, -5965, 2181, 4232, -3003, 7535, 6374, 4839, -98), _mm256_set_epi16(-2748, -23320, -22804, -19544, -32476, 20009, 25027, -18657, -25449, 9305, 18055, -12812, 32147, 27194, 20645, -418), _mm256_set_epi16(3659, -2767, 6245, 2867, 3741, 5562, 6280, 3498, 2850, -3104, 7211, -4295, -3237, 2620, -755, -445), _mm256_set_epi16(15611, -11805, 26644, 12232, 15961, 23730, 26793, 14924, 12159, -13243, 30765, -18324, -13810, 11178, -3221, -1899), _mm256_set_epi16(2579, 3046, 6920, 6908, -7652, -5561, -811, -7599, 2882, -7192, 6850, 7191, 2730, 3135, -2956, -6396), _mm256_set_epi16(11003, 12995, 29523, 29472, -32646, -23725, -3460, -32420, 12296, -30684, 29225, 30680, 11647, 13375, -12611, -27288), _mm256_set_epi16(-2764, -202, 5301, -5159, -3204, -5436, -1801, 3503, 1305, -1583, -863, 1119, 6859, 3180, 608, -867), _mm256_set_epi16(-11792, -862, 22616, -22010, -13670, -23192, -7684, 14945, 5568, -6754, -3682, 4774, 29263, 13567, 2594, -3699), _mm256_set_epi16(-980, -2307, -1455, -2296, -692, 3763, 6449, -1794, 817, -685, 2784, -2353, -7367, 273, 6784, 6440), _mm256_set_epi16(-4181, -9843, -6208, -9796, -2952, 16054, 27514, -7654, 3486, -2922, 11878, -10039, -31430, 1165, 28943, 27476), _mm256_set_epi16(4450, -7550, -4522, -1648, -3133, 4695, 318, -2222, 1356, -4258, 6688, 5824, 3052, 5868, 2052, 1006), _mm256_set_epi16(18985, -32211, -19293, -7031, -13367, 20031, 1357, -9480, 5785, -18166, 28534, 24847, 13021, 25035, 8755, 4292), _mm256_set_epi16(4932, -262, 7605, -7636, 5834, 285, -815, 7251, -2516, 1162, -3422, -628, -7056, -4895, 4885, -1902), _mm256_set_epi16(21042, -1118, 32446, -32578, 24890, 1216, -3477, 30936, -10734, 4958, -14600, -2679, -30104, -20884, 20841, -8115), _mm256_set_epi16(3082, 2020, -6927, -5507, 7084, 1318, 2649, -4308, -1078, -7146, -6080, -6691, 6731, 4171, 2311, 469), _mm256_set_epi16(13149, 8618, -29553, -23495, 30223, 5623, 11302, -18380, -4599, -30488, -25940, -28546, 28717, 17795, 9860, 2001)];

    // inverse Layer 8
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_15361(a[2*i], a[2*i+1], l8[2*i], l8[2*i+1]);
    }
    // inverse Layer 7
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_15361(a0[i*4+j], a0[i*4+j+2], l7[2*i], l7[2*i+1]);
        }
    }
    // inverse Layer 6
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_15361(a1[i], a1[i+4], l6[0], l6[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_15361(a1[i+8], a1[i+12], l6[2], l6[3]);
    }
    // inverse Layer 5
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_15361(a0[i], a0[i+8], l5[0], l5[1]);
    }
    a1
}