#[cfg(target_arch = "x86_64")]
use std::arch::x86_64::*;
use crate::field::fields::*;
use crate::ntt::transpose::*;

#[target_feature(enable = "avx2")]
pub unsafe fn intt_7681(s0: [__m256i;16]) -> [__m256i;16]{
    let s1 = intt5678_7681(s0);
    let s2 = transpose(s1);
    let s3 = intt1234_7681(s2);
    s3
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt1234_7681(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l1 ~ l4
    let l1:[__m256i;2] = [_mm256_set1_epi16(-3383), _mm256_set1_epi16(-28865)];
    let l2:[__m256i;4] = [_mm256_set1_epi16(1213), _mm256_set1_epi16(10350), _mm256_set1_epi16(1925), _mm256_set1_epi16(16425)];
    let l3:[__m256i;8] = [_mm256_set1_epi16(527), _mm256_set1_epi16(4496), _mm256_set1_epi16(849), _mm256_set1_epi16(7244), _mm256_set1_epi16(583), _mm256_set1_epi16(4974), _mm256_set1_epi16(1728), _mm256_set1_epi16(14744)];
    let l4:[__m256i;16] = [_mm256_set1_epi16(2784), _mm256_set1_epi16(23754), _mm256_set1_epi16(1366), _mm256_set1_epi16(11655), _mm256_set1_epi16(-2138), _mm256_set1_epi16(-18242), _mm256_set1_epi16(2648), _mm256_set1_epi16(22593), _mm256_set1_epi16(2381), _mm256_set1_epi16(20315), _mm256_set1_epi16(2446), _mm256_set1_epi16(20870), _mm256_set1_epi16(-97), _mm256_set1_epi16(-828), _mm256_set1_epi16(2132), _mm256_set1_epi16(18191)];

    // inverse Layer 4
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_7681(a[2*i], a[2*i+1], l4[2*i], l4[2*i+1]);
    }
    // inverse Layer 3
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_ibutterfly_7681(a0[i*4+j], a0[i*4+j+2], l3[2*i], l3[2*i+1]);
        }
    }
    // inverse Layer 2
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_ibutterfly_7681(a1[i], a1[i+4], l2[0], l2[1]);
        [a0[i+8], a0[i+12]] = barrett_ibutterfly_7681(a1[i+8], a1[i+12], l2[2], l2[3]);
    }
    // inverse Layer 1
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_ibutterfly_7681(a0[i], a0[i+8], l1[0], l1[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt5678_7681(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l5 ~ l8
    let l5:[__m256i;2] = [_mm256_set_epi16(-3000, 2399, -1794, -1112, -2268, 675, 3092, 1286, -1846, 365, -3654, -2753, -2645, 330, 2273, 878), _mm256_set_epi16(-25597, 20469, -15307, -9488, -19351, 5759, 26382, 10972, -15750, 3114, -31177, -23489, -22568, 2816, 19394, 7491)];
    let l6:[__m256i;4] = [_mm256_set_epi16(2881, -202, -3411, -1080, -3449, 2941, -584, -1740, -732, -3080, 693, -2469, 1382, 2724, -1381, -799), _mm256_set_epi16(24581, -1724, -29103, -9215, -29428, 25093, -4983, -14846, -6246, -26279, 5913, -21066, 11792, 23242, -11783, -6817), _mm256_set_epi16(-766, 243, -2551, 2516, 528, 2508, 1655, -2774, 3074, 3477, -1714, -3380, -2423, 1908, 1875, -695), _mm256_set_epi16(-6536, 2073, -21766, 21467, 4505, 21399, 14121, -23668, 26228, 29667, -14624, -28839, -20674, 16279, 15998, -5930)];
    let l7:[__m256i;8] = [_mm256_set_epi16(993, 1003, 2562, -2880, -1591, 550, -2990, 1125, -1402, -257, -1886, -1155, 1633, 405, -880, -1587), _mm256_set_epi16(8472, 8558, 21860, -24573, -13575, 4693, -25511, 9599, -11962, -2193, -16092, -9855, 13933, 3456, -7508, -13541), _mm256_set_epi16(-2722, -1853, -3078, -3532, 2028, -1848, -707, -3780, 3789, 1478, 2573, 2264, 1800, -2897, -3188, 198), _mm256_set_epi16(-23225, -15810, -26262, -30136, 17303, -15768, -6032, -32252, 32329, 12611, 21953, 19317, 15358, -24718, -27201, 1689), _mm256_set_epi16(1044, 2844, 648, -1682, 1952, 1228, 1438, -417, 3125, 3141, -1220, -3566, 1996, 319, 219, 2900), _mm256_set_epi16(8908, 24266, 5529, -14351, 16655, 10478, 12269, -3558, 26663, 26800, -10409, -30426, 17030, 2722, 1869, 24743), _mm256_set_epi16(-1408, 3041, -3099, 1415, 2044, 1097, -2681, 2593, -2819, 3180, -2563, 3073, -869, 3837, -3501, -2063), _mm256_set_epi16(-12013, 25946, -26441, 12073, 17440, 9360, -22875, 22124, -24052, 27132, -21868, 26220, -7415, 32738, -29871, -17602)];
    let l8:[__m256i;16] = [_mm256_set_epi16(2050, -217, 3193, 2110, 3751, -2840, 335, -3250, 3139, -1230, -2173, 3081, 1607, -1950, 2358, 763), _mm256_set_epi16(17491, -1851, 27243, 18003, 32004, -24232, 2858, -27730, 26783, -10495, -18541, 26288, 13711, -16638, 20119, 6510), _mm256_set_epi16(793, -3265, -2433, 2481, -621, 1211, 3483, -3239, -3586, -2012, 542, 94, 1667, 1129, -3445, -413), _mm256_set_epi16(6766, -27858, -20759, 21168, -5299, 10333, 29718, -27636, -30597, -17167, 4624, 802, 14223, 9633, -29394, -3524), _mm256_set_epi16(-1994, -2951, 1885, 1499, 535, 3832, -738, -1897, -2169, -1876, -3120, -1193, -1968, -398, 2922, -1704), _mm256_set_epi16(-17013, -25179, 16083, 12790, 4565, 32695, -6297, -16186, -18506, -16006, -26621, -10179, -16791, -3396, 24931, -14539), _mm256_set_epi16(1784, -2067, 1725, -1657, -2811, -1872, 329, 3765, -2372, -2002, -1266, -3394, 1683, 2259, 321, -3799), _mm256_set_epi16(15221, -17636, 14718, -14138, -23984, -15972, 2807, 32124, -20238, -17082, -10802, -28958, 14360, 19274, 2739, -32414), _mm256_set_epi16(-1459, 3615, -2717, 2395, 3016, -639, 218, -2457, 296, 2197, -1437, 1131, 201, -3546, 1656, -2689), _mm256_set_epi16(-12449, 30844, -23182, 20435, 25733, -5452, 1860, -20964, 2526, 18745, -12261, 9650, 1715, -30255, 14129, -22943), _mm256_set_epi16(-3086, 1393, -2546, -1170, 2760, -3376, -118, -1189, 2838, 2757, 702, 1035, -3626, -1604, -2799, 2583), _mm256_set_epi16(-26330, 11885, -21723, -9983, 23549, -28805, -1007, -10145, 24214, 23523, 5990, 8831, -30938, -13686, -23882, 22039), _mm256_set_epi16(-2671, 856, 572, -1775, -2252, -674, 3280, -1771, 1959, 3006, 1065, 3452, -1979, -2359, 3694, -2668), _mm256_set_epi16(-22790, 7304, 4880, -15145, -19215, -5751, 27986, -15111, 16715, 25648, 9087, 29453, -16885, -20128, 31518, -22764), _mm256_set_epi16(3137, 111, 536, -1717, 1036, 1115, 2805, 113, -1406, 346, 506, -2996, 2875, 62, 185, -669), _mm256_set_epi16(26766, 947, 4573, -14650, 8839, 9513, 23933, 964, -11996, 2952, 4317, -25563, 24530, 529, 1578, -5708)];

    // inverse Layer 8
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_7681(a[2*i], a[2*i+1], l8[2*i], l8[2*i+1]);
    }
    // inverse Layer 7
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_ibutterfly_7681(a0[i*4+j], a0[i*4+j+2], l7[2*i], l7[2*i+1]);
        }
    }
    // inverse Layer 6
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_ibutterfly_7681(a1[i], a1[i+4], l6[0], l6[1]);  
        [a0[i+8], a0[i+12]] = barrett_ibutterfly_7681(a1[i+8], a1[i+12], l6[2], l6[3]);
    }
    // inverse Layer 5
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_ibutterfly_7681(a0[i], a0[i+8], l5[0], l5[1]);  
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt_10753(s0: [__m256i;16]) -> [__m256i;16]{
    let s1 = intt5678_10753(s0);
    let s2 = transpose(s1);
    let s3 = intt1234_10753(s2);
    s3
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt1234_10753(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l1 ~ l4
    let l1:[__m256i;2] = [_mm256_set1_epi16(-4489), _mm256_set1_epi16(-27359)];
    let l2:[__m256i;4] = [_mm256_set1_epi16(321), _mm256_set1_epi16(1956), _mm256_set1_epi16(67), _mm256_set1_epi16(408)];
    let l3:[__m256i;8] = [_mm256_set1_epi16(1656), _mm256_set1_epi16(10093), _mm256_set1_epi16(3461), _mm256_set1_epi16(21094), _mm256_set1_epi16(3422), _mm256_set1_epi16(20856), _mm256_set1_epi16(4679), _mm256_set1_epi16(28517)];
    let l4:[__m256i;16] = [_mm256_set1_epi16(2640), _mm256_set1_epi16(16090), _mm256_set1_epi16(-1154), _mm256_set1_epi16(-7033), _mm256_set1_epi16(-4832), _mm256_set1_epi16(-29449), _mm256_set1_epi16(2047), _mm256_set1_epi16(12476), _mm256_set1_epi16(1560), _mm256_set1_epi16(9508), _mm256_set1_epi16(-2637), _mm256_set1_epi16(-16072), _mm256_set1_epi16(-4631), _mm256_set1_epi16(-28224), _mm256_set1_epi16(3010), _mm256_set1_epi16(18345)];

    // inverse Layer 4
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_10753(a[2*i], a[2*i+1], l4[2*i], l4[2*i+1]);
    }
    // inverse Layer 3
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_ibutterfly_10753(a0[i*4+j], a0[i*4+j+2], l3[2*i], l3[2*i+1]);
        }
    }
    // inverse Layer 2
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_ibutterfly_10753(a1[i], a1[i+4], l2[0], l2[1]); 
        [a0[i+8], a0[i+12]] = barrett_ibutterfly_10753(a1[i+8], a1[i+12], l2[2], l2[3]);
    }
    // inverse Layer 1
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_ibutterfly_10753(a0[i], a0[i+8], l1[0], l1[1]); 
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt5678_10753(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l5 ~ l8
    let l5:[__m256i;2] = [_mm256_set_epi16(136, 2417, -1641, 644, -3013, -1917, -2436, -597, 1186, 1219, 4191, -4351, -2900, -3783, -746, -4611), _mm256_set_epi16(829, 14731, -10001, 3925, -18363, -11683, -14847, -3639, 7228, 7429, 25543, -26518, -17675, -23056, -4547, -28103)];
    let l6:[__m256i;4] = [_mm256_set_epi16(1136, 946, -5194, -559, 4455, 94, 5122, -1047, 3171, 2603, -1385, -3982, 753, 5147, -3954, -3907), _mm256_set_epi16(6924, 5766, -31656, -3407, 27152, 573, 31217, -6381, 19326, 15864, -8441, -24269, 4589, 31369, -24098, -23812), _mm256_set_epi16(2582, -841, -3362, 3902, 2085, 2599, -2744, -922, 2353, -3644, 2031, -3712, 3775, 3314, 3697, -380), _mm256_set_epi16(15736, -5126, -20490, 23781, 12707, 15840, -16724, -5619, 14341, -22209, 12378, -22623, 23007, 20198, 22532, -2316)];
    let l7:[__m256i;8] = [_mm256_set_epi16(5012, 1943, -1289, -5263, -5178, 4193, 4683, 2135, 118, 3719, -671, 267, -2726, -2004, -5125, -685), _mm256_set_epi16(30546, 11842, -7856, -32076, -31558, 25555, 28541, 13012, 719, 22666, -4090, 1627, -16614, -12214, -31235, -4175), _mm256_set_epi16(-3592, 1444, 1207, -1266, 3944, -4627, -128, -3092, -2805, 4818, -1279, -4980, -100, 4305, -5295, 393), _mm256_set_epi16(-21892, 8801, 7356, -7716, 24037, -28200, -780, -18845, -17096, 29364, -7795, -30351, -609, 26238, -32271, 2395), _mm256_set_epi16(-2461, 1145, -339, 1202, -4577, -1353, -2177, 3256, -5134, 1854, 331, 3617, 159, -1896, 721, -2883), _mm256_set_epi16(-14999, 6978, -2066, 7326, -27895, -8246, -13268, 19844, -31290, 11300, 2017, 22044, 969, -11555, 4394, -17571), _mm256_set_epi16(4098, 29, 5155, 2228, 2830, -1828, -1924, -2857, 2847, 216, 1945, -317, -4053, 5232, -84, 4825), _mm256_set_epi16(24976, 177, 31418, 13579, 17248, -11141, -11726, -17412, 17352, 1316, 11854, -1932, -24702, 31887, -512, 29407)];
    let l8:[__m256i;16] = [_mm256_set_epi16(-3429, -1445, 2037, -4209, -2266, -2758, 3661, -1907, -3992, -2545, -4711, 1196, 670, -1036, -2129, -1102), _mm256_set_epi16(-20899, -8807, 12415, -25652, -13811, -16809, 22313, -11623, -24330, -15511, -28712, 7289, 4083, -6314, -12976, -6716), _mm256_set_epi16(-5238, 2546, -4043, -1180, 264, 3959, -3645, -1135, -5163, 4819, 3472, 3097, 3210, -5308, 2336, -498), _mm256_set_epi16(-31924, 15517, -24641, -7192, 1609, 24129, -22215, -6917, -31467, 29370, 21161, 18875, 19564, -32351, 14237, -3035), _mm256_set_epi16(3903, 38, -2056, 2425, -1280, 3572, -2032, -774, -1825, 283, -3800, -3192, 1878, 4894, 4783, 1437), _mm256_set_epi16(23788, 232, -12531, 14780, -7801, 21770, -12384, -4717, -11123, 1725, -23160, -19454, 11446, 29827, 29151, 8758), _mm256_set_epi16(-3930, 1466, -3310, -3789, 3818, -1985, -3104, 1267, 1361, 1533, -3942, -4861, 10, -787, 2854, -1107), _mm256_set_epi16(-23952, 8935, -20173, -23093, 23269, -12098, -18918, 7722, 8295, 9343, -24025, -29626, 61, -4797, 17394, -6747), _mm256_set_epi16(815, -1590, -2670, 2966, -3689, 1082, 2076, 1317, 2343, -940, 3223, -4524, -2351, 4847, 5096, 3259), _mm256_set_epi16(4967, -9691, -16273, 18077, -22483, 6594, 12653, 8027, 14280, -5729, 19643, -27572, -14329, 29541, 31058, 19863), _mm256_set_epi16(2515, 2482, -3965, -2160, -301, 3258, 3687, -2137, 1293, -4484, -5262, -4181, 4946, -4864, -4313, -5182), _mm256_set_epi16(15328, 15127, -24165, -13164, -1834, 19856, 22471, -13024, 7880, -27329, -32070, -25482, 30144, -29644, -26286, -31583), _mm256_set_epi16(3543, -4999, 3911, -4931, 156, 3226, 290, -3390, 607, -656, -881, -2024, -1961, -2159, -2664, -3293), _mm256_set_epi16(21593, -30467, 23836, -30053, 951, 19661, 1767, -20661, 3699, -3998, -5369, -12336, -11952, -13158, -16236, -20070), _mm256_set_epi16(-840, -1000, 3170, 5168, -1339, 2777, -697, -2215, -4314, 1538, 2295, 549, 3778, 3298, -1360, -3098), _mm256_set_epi16(-5120, -6095, 19320, 31497, -8161, 16925, -4248, -13500, -26292, 9374, 13987, 3346, 23026, 20100, -8289, -18881)];

    // inverse Layer 8
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_10753(a[2*i], a[2*i+1], l8[2*i], l8[2*i+1]);
    }
    // inverse Layer 7
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_ibutterfly_10753(a0[i*4+j], a0[i*4+j+2], l7[2*i], l7[2*i+1]);
        }
    }
    // inverse Layer 6
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_ibutterfly_10753(a1[i], a1[i+4], l6[0], l6[1]); 
        [a0[i+8], a0[i+12]] = barrett_ibutterfly_10753(a1[i+8], a1[i+12], l6[2], l6[3]);
    }
    // inverse Layer 5
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_ibutterfly_10753(a0[i], a0[i+8], l5[0], l5[1]); 
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt_11777(s0: [__m256i;16]) -> [__m256i;16]{
    let s1 = intt5678_11777(s0);
    let s2 = transpose(s1);
    let s3 = intt1234_11777(s2);
    s3
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt1234_11777(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l1 ~ l4
    let l1:[__m256i;2] = [_mm256_set1_epi16(-5322), _mm256_set1_epi16(-29616)];
    let l2:[__m256i;4] = [_mm256_set1_epi16(4201), _mm256_set1_epi16(23377), _mm256_set1_epi16(4976), _mm256_set1_epi16(27690)];
    let l3:[__m256i;8] = [_mm256_set1_epi16(-3410), _mm256_set1_epi16(-18976), _mm256_set1_epi16(-337), _mm256_set1_epi16(-1875), _mm256_set1_epi16(-2497), _mm256_set1_epi16(-13895), _mm256_set1_epi16(-4578), _mm256_set1_epi16(-25475)];
    let l4:[__m256i;16] = [_mm256_set1_epi16(-4782), _mm256_set1_epi16(-26611), _mm256_set1_epi16(-293), _mm256_set1_epi16(-1630), _mm256_set1_epi16(2380), _mm256_set1_epi16(13244), _mm256_set1_epi16(5692), _mm256_set1_epi16(31675), _mm256_set1_epi16(-1447), _mm256_set1_epi16(-8052), _mm256_set1_epi16(-1224), _mm256_set1_epi16(-6811), _mm256_set1_epi16(4525), _mm256_set1_epi16(25180), _mm256_set1_epi16(1915), _mm256_set1_epi16(10656)];


    // inverse Layer 4
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_11777(a[2*i], a[2*i+1], l4[2*i], l4[2*i+1]);
    }
    // inverse Layer 3
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_ibutterfly_11777(a0[i*4+j], a0[i*4+j+2], l3[2*i], l3[2*i+1]);
        }
    }
    // inverse Layer 2
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_ibutterfly_11777(a1[i], a1[i+4], l2[0], l2[1]); 
        [a0[i+8], a0[i+12]] = barrett_ibutterfly_11777(a1[i+8], a1[i+12], l2[2], l2[3]);
    }
    // inverse Layer 1
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_ibutterfly_11777(a0[i], a0[i+8], l1[0], l1[1]); 
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt5678_11777(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l5 ~ l8
    let l5:[__m256i;2] = [_mm256_set_epi16(-3268, 2333, -2469, 3114, -5722, 2838, -4114, 1265, -3587, 503, -5020, 5573, 5558, -4148, 4212, -4633), _mm256_set_epi16(-18186, 12983, -13739, 17329, -31841, 15793, -22893, 7039, -19961, 2799, -27935, 31012, 30929, -23083, 23439, -25781)];
    let l6:[__m256i;4] = [_mm256_set_epi16(-5513, -4055, -403, 3238, -1362, 5537, -5203, -309, 2500, 3488, -2244, -1548, -2020, -5739, 3384, 1345), _mm256_set_epi16(-30678, -22565, -2243, 18019, -7579, 30812, -28953, -1720, 13912, 19410, -12487, -8614, -11241, -31936, 18831, 7485), _mm256_set_epi16(-3679, -5246, 1352, -2885, 5709, -1860, -2639, 4282, -3010, -2584, -690, -5444, 1961, -5197, -2615, -2326), _mm256_set_epi16(-20473, -29193, 7524, -16054, 31769, -10350, -14685, 23828, -16750, -14379, -3840, -30294, 10912, -28920, -14552, -12944)];
    let l7:[__m256i;8] = [_mm256_set_epi16(3673, 2802, -2926, 4779, -1203, 4302, -4547, -1329, -50, 4697, 1534, 2873, -3452, -1120, 1596, -1386), _mm256_set_epi16(20439, 15592, -16282, 26594, -6694, 23940, -25303, -7396, -278, 26138, 8536, 15988, -19209, -6233, 8881, -7713), _mm256_set_epi16(2114, 2562, -2978, -4482, 4322, -756, 2601, -5039, 4771, -5137, 2487, 3560, -576, -1478, -2695, 3890), _mm256_set_epi16(11764, 14257, -16572, -24941, 24051, -4207, 14474, -28041, 26549, -28586, 13840, 19810, -3205, -8225, -14997, 21647), _mm256_set_epi16(1056, 1216, -3062, 3206, -1470, -4993, -2255, 5570, -1483, 5622, 1688, -1952, 5491, 2599, -3683, 4586), _mm256_set_epi16(5876, 6767, -17039, 17841, -8180, -27785, -12548, 30996, -8253, 31285, 9393, -10862, 30556, 14463, -20495, 25520), _mm256_set_epi16(2403, -5798, 3404, 2541, 3412, -3834, -347, -831, -1936, 5073, 2315, 1230, -4365, -5680, -3998, -4748), _mm256_set_epi16(13372, -32264, 18942, 14140, 18987, -21335, -1931, -4624, -10773, 28230, 12882, 6845, -24290, -31608, -22248, -26421)];
    let l8:[__m256i;16] = [_mm256_set_epi16(-3326, -4071, 803, -5518, 5495, 5713, 2265, 3435, 3875, -3131, 3225, -2105, -5169, -1148, 2550, 4905), _mm256_set_epi16(-18508, -22654, 4468, -30706, 30578, 31791, 12604, 19115, 21563, -17423, 17946, -11714, -28764, -6388, 14190, 27295), _mm256_set_epi16(141, -3818, -1485, 5042, -2099, 3628, 5318, 3166, 1223, 1273, 4361, -2883, 1654, 2607, 3996, 5199), _mm256_set_epi16(785, -21246, -8264, 28057, -11680, 20189, 29593, 17618, 6806, 7084, 24268, -16043, 9204, 14507, 22237, 28931), _mm256_set_epi16(5004, -856, -3325, 5381, 3074, -1213, 51, 3610, -3051, 1115, 4451, -4727, 1819, 603, 4520, -3845), _mm256_set_epi16(27846, -4763, -18503, 29944, 17106, -6750, 284, 20089, -16978, 6205, 24769, -26305, 10122, 3356, 25153, -21396), _mm256_set_epi16(-3491, -2067, -5181, 3982, -1575, 1790, 551, -4133, 3061, 1578, -4675, -1422, 24, 5822, -4971, 5336), _mm256_set_epi16(-19427, -11502, -28831, 22159, -8764, 9961, 3066, -22999, 17034, 8781, -26015, -7913, 134, 32398, -27662, 29693), _mm256_set_epi16(1233, 5824, 260, -1200, 743, 2172, 2745, 3539, -4819, 5029, 2643, 5857, 599, 3002, -371, 295), _mm256_set_epi16(6861, 32409, 1447, -6678, 4135, 12087, 15275, 19694, -26817, 27985, 14708, 32593, 3333, 16705, -2065, 1642), _mm256_set_epi16(-2237, -1736, 5811, 3266, 2826, -5630, 5410, 3135, -3588, 4783, -4308, -2765, 3689, 4745, -4074, -3649), _mm256_set_epi16(-12448, -9660, 32337, 18174, 15726, -31330, 30105, 17445, -19966, 26616, -23973, -15387, 20528, 26405, -22671, -20306), _mm256_set_epi16(409, -2973, -1710, 644, -438, -3414, 2200, 4765, -1372, -1109, -2468, 3104, -3879, 1765, -2893, -2710), _mm256_set_epi16(2276, -16544, -9516, 3584, -2437, -18998, 12242, 26516, -7635, -6171, -13734, 17273, -21586, 9822, -16099, -15080), _mm256_set_epi16(2047, 5795, 3001, 261, 810, -2603, -2062, -3449, 44, 1821, 3341, -3643, 1043, 4716, 4007, 4205), _mm256_set_epi16(11391, 32248, 16700, 1452, 4507, -14485, -11475, -19193, 245, 10133, 18592, -20272, 5804, 26243, 22298, 23400)];


    // inverse Layer 8
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_11777(a[2*i], a[2*i+1], l8[2*i], l8[2*i+1]);
    }
    // inverse Layer 7
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_ibutterfly_11777(a0[i*4+j], a0[i*4+j+2], l7[2*i], l7[2*i+1]);
        }
    }
    // inverse Layer 6
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_ibutterfly_11777(a1[i], a1[i+4], l6[0], l6[1]); 
        [a0[i+8], a0[i+12]] = barrett_ibutterfly_11777(a1[i+8], a1[i+12], l6[2], l6[3]);
    }
    // inverse Layer 5
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_ibutterfly_11777(a0[i], a0[i+8], l5[0], l5[1]); 
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt_12289(s0: [__m256i;16]) -> [__m256i;16]{
    let s1 = intt5678_12289(s0);
    let s2 = transpose(s1);
    let s3 = intt1234_12289(s2);
    s3
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt1234_12289(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l1 ~ l4
    let l1:[__m256i;2] = [_mm256_set1_epi16(-1479), _mm256_set1_epi16(-7887)];
    let l2:[__m256i;4] = [_mm256_set1_epi16(5146), _mm256_set1_epi16(27443), _mm256_set1_epi16(4043), _mm256_set1_epi16(21561)];
    let l3:[__m256i;8] = [_mm256_set1_epi16(-722), _mm256_set1_epi16(-3850), _mm256_set1_epi16(-1305), _mm256_set1_epi16(-6959), _mm256_set1_epi16(-5736), _mm256_set1_epi16(-30590), _mm256_set1_epi16(-4134), _mm256_set1_epi16(-22046)];
    let l4:[__m256i;16] = [_mm256_set1_epi16(3621), _mm256_set1_epi16(19310), _mm256_set1_epi16(2545), _mm256_set1_epi16(13572), _mm256_set1_epi16(-3542), _mm256_set1_epi16(-18889), _mm256_set1_epi16(3504), _mm256_set1_epi16(18686), _mm256_set1_epi16(1212), _mm256_set1_epi16(6463), _mm256_set1_epi16(1646), _mm256_set1_epi16(8778), _mm256_set1_epi16(3195), _mm256_set1_epi16(17039), _mm256_set1_epi16(-5860), _mm256_set1_epi16(-31251)];

    // inverse Layer 4
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_12289(a[2*i], a[2*i+1], l4[2*i], l4[2*i+1]);
    }
    // inverse Layer 3
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_ibutterfly_12289(a0[i*4+j], a0[i*4+j+2], l3[2*i], l3[2*i+1]);
        }
    }
    // inverse Layer 2
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_ibutterfly_12289(a1[i], a1[i+4], l2[0], l2[1]); 
        [a0[i+8], a0[i+12]] = barrett_ibutterfly_12289(a1[i+8], a1[i+12], l2[2], l2[3]);
    }
    // inverse Layer 1
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_ibutterfly_12289(a0[i], a0[i+8], l1[0], l1[1]); 
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt5678_12289(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l5 ~ l8
    let l5:[__m256i;2] = [_mm256_set_epi16(4978, 1351, -5777, -3328, 5728, -4591, 5828, 5023, -2625, -949, 4821, 2639, 563, 2975, 2744, -3006), _mm256_set_epi16(26547, 7205, -30808, -17748, 30547, -24483, 31080, 26787, -13999, -5061, 25710, 14074, 3002, 15865, 14633, -16031)];
    let l6:[__m256i;4] = [_mm256_set_epi16(-1853, -4611, 1635, -1177, 3091, -4320, -3051, 2963, -3201, 5086, -1170, -955, -2747, 3712, 2294, 4805), _mm256_set_epi16(-9882, -24590, 8719, -6277, 16484, -23038, -16271, 15801, -17071, 27123, -6239, -5093, -14649, 19796, 12234, 25625), _mm256_set_epi16(-140, 726, -2768, 4255, -81, 1000, -2366, -4896, 3014, -1326, 2319, -790, -4846, -3135, -1062, -3553), _mm256_set_epi16(-747, 3872, -14761, 22691, -432, 5333, -12618, -26110, 16073, -7071, 12367, -4213, -25843, -16719, -5664, -18948)];
    let l7:[__m256i;8] = [_mm256_set_epi16(-4452, -4354, -118, -953, -2842, -2468, -4177, 4278, 2013, -2881, -4632, -2426, -1759, 2548, -5911, -3637), _mm256_set_epi16(-23742, -23219, -629, -5082, -15156, -13162, -22276, 22814, 10735, -15364, -24702, -12938, -9381, 13588, -31523, -19396), _mm256_set_epi16(-2396, -130, -2476, -3748, 480, -339, -3584, -1673, 3289, -3284, -5755, -334, -3707, -4231, 4890, -3459), _mm256_set_epi16(-12778, -693, -13204, -19988, 2560, -1808, -19113, -8922, 17540, -17513, -30691, -1781, -19769, -22563, 26078, -18446), _mm256_set_epi16(-3949, 5374, 2197, -5767, 1022, -544, -2525, -5331, -729, -5092, 1260, 1428, 5179, 3382, 2731, -145), _mm256_set_epi16(-21060, 28659, 11716, -30755, 5450, -2901, -13466, -28430, -3888, -27155, 6719, 7615, 27619, 18036, 14564, -773), _mm256_set_epi16(3296, -2837, 5067, -827, 9, -5791, 1381, 4989, -3241, -2089, -4388, -1696, -3694, -355, 3932, -5542), _mm256_set_epi16(17577, -15129, 27022, -4410, 48, -30883, 7365, 26606, -17284, -11140, -23401, -9045, -19700, -1893, 20969, -29555)];
    let l8:[__m256i;16] = [_mm256_set_epi16(671, 5559, -3186, -3247, -2166, -3636, -5042, 4057, 1017, -242, 773, -4861, 4976, 2187, -1378, -2143), _mm256_set_epi16(3578, 29646, -16991, -17316, -11551, -19390, -26888, 21636, 5424, -1291, 4122, -25923, 26537, 11663, -7349, -11428), _mm256_set_epi16(3000, 420, 5407, 2686, -3915, 4938, -2305, -3271, -4885, -1537, -390, -354, 1607, -2566, -1912, -1065), _mm256_set_epi16(15999, 2240, 28835, 14324, -20878, 26334, -12292, -17444, -26051, -8197, -2080, -1888, 8570, -13684, -10197, -5680), _mm256_set_epi16(-243, -1544, -2126, 3978, -113, -2704, 4053, 3364, -5084, -4143, 3833, 5698, -3780, 6039, -435, -4645), _mm256_set_epi16(-1296, -8234, -11338, 21214, -603, -14420, 21614, 17940, -27112, -22094, 20441, 30387, -20158, 32205, -2320, -24771), _mm256_set_epi16(-3016, 2178, 1630, -2969, -4919, -5291, 2645, 1689, 1632, -4714, 3778, 2912, -875, 2422, -4337, -404), _mm256_set_epi16(-16084, 11615, 8693, -15833, -26233, -28216, 14106, 9007, 8703, -25139, 20148, 15529, -4666, 12916, -23129, -2154), _mm256_set_epi16(3400, -476, -1153, -3510, 160, -1777, 4895, 2847, 3066, -2678, -2401, 5012, 4284, 2437, -4096, -5277), _mm256_set_epi16(18132, -2538, -6149, -18718, 853, -9477, 26105, 15183, 16351, -14282, -12804, 26728, 22846, 12996, -21844, -28142), _mm256_set_epi16(-2399, -3531, 2884, -5332, 3149, -1663, -1484, 4414, -27, 3704, -442, -2481, 5088, -3646, -493, -1168), _mm256_set_epi16(-12794, -18830, 15380, -28435, 16793, -8869, -7914, 23539, -144, 19753, -2357, -13231, 27134, -19444, -2629, -6229), _mm256_set_epi16(3136, 4905, 4048, -2865, -3, -4654, 5195, 4372, 1440, 5019, 1067, -1045, -1002, 6022, 2381, 1207), _mm256_set_epi16(16724, 26158, 21588, -15279, -16, -24819, 27704, 23315, 7679, 26766, 5690, -5573, -5344, 32115, 12698, 6437), _mm256_set_epi16(-5191, 3985, -2249, -2370, -4437, -1426, 2780, -2174, -3763, -545, 5101, 2859, 5011, 2987, 5444, -3248), _mm256_set_epi16(-27683, 21252, -11994, -12639, -23662, -7605, 14825, -11594, -20068, -2906, 27203, 15247, 26723, 15929, 29032, -17321)];

    // inverse Layer 8
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_12289(a[2*i], a[2*i+1], l8[2*i], l8[2*i+1]);
    }
    // inverse Layer 7
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_ibutterfly_12289(a0[i*4+j], a0[i*4+j+2], l7[2*i], l7[2*i+1]);
        }
    }
    // inverse Layer 6
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_ibutterfly_12289(a1[i], a1[i+4], l6[0], l6[1]); 
        [a0[i+8], a0[i+12]] = barrett_ibutterfly_12289(a1[i+8], a1[i+12], l6[2], l6[3]);
    }
    // inverse Layer 5
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_ibutterfly_12289(a0[i], a0[i+8], l5[0], l5[1]); 
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt_13313(s0: [__m256i;16]) -> [__m256i;16]{
    let s1 = intt5678_13313(s0);
    let s2 = transpose(s1);
    let s3 = intt1234_13313(s2);
    s3
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt1234_13313(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l1 ~ l4
    let l1:[__m256i;2] = [_mm256_set1_epi16(-258), _mm256_set1_epi16(-1270)];
    let l2:[__m256i;4] = [_mm256_set1_epi16(-2626), _mm256_set1_epi16(-12927), _mm256_set1_epi16(-1455), _mm256_set1_epi16(-7163)];
    let l3:[__m256i;8] = [_mm256_set1_epi16(-6630), _mm256_set1_epi16(-32638), _mm256_set1_epi16(6476), _mm256_set1_epi16(31879), _mm256_set1_epi16(3024), _mm256_set1_epi16(14886), _mm256_set1_epi16(-5275), _mm256_set1_epi16(-25967)];
    let l4:[__m256i;16] = [_mm256_set1_epi16(4215), _mm256_set1_epi16(20749), _mm256_set1_epi16(4196), _mm256_set1_epi16(20656), _mm256_set1_epi16(5487), _mm256_set1_epi16(27011), _mm256_set1_epi16(4468), _mm256_set1_epi16(21995), _mm256_set1_epi16(4690), _mm256_set1_epi16(23087), _mm256_set1_epi16(1463), _mm256_set1_epi16(7202), _mm256_set1_epi16(5619), _mm256_set1_epi16(27661), _mm256_set1_epi16(1415), _mm256_set1_epi16(6966)];

    // inverse Layer 4
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_13313(a[2*i], a[2*i+1], l4[2*i], l4[2*i+1]);
    }
    // inverse Layer 3
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_ibutterfly_13313(a0[i*4+j], a0[i*4+j+2], l3[2*i], l3[2*i+1]);
        }
    }
    // inverse Layer 2
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_ibutterfly_13313(a1[i], a1[i+4], l2[0], l2[1]); 
        [a0[i+8], a0[i+12]] = barrett_ibutterfly_13313(a1[i+8], a1[i+12], l2[2], l2[3]);
    }
    // inverse Layer 1
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_ibutterfly_13313(a0[i], a0[i+8], l1[0], l1[1]); 
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt5678_13313(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l5 ~ l8
    let l5:[__m256i;2] = [_mm256_set_epi16(2198, -5375, -2970, -5894, 2651, 4995, -3565, 1173, 3902, 5072, -4358, 6072, -1152, -4330, 1278, -3101), _mm256_set_epi16(10820, -26460, -14620, -29014, 13050, 24589, -17549, 5774, 19208, 24968, -21453, 29891, -5671, -21315, 6291, -15265)];
    let l6:[__m256i;4] = [_mm256_set_epi16(2878, 6105, 3630, 272, 2368, -2627, 3606, 3813, 714, -2169, -4253, 1229, 4753, -6168, 3696, -772), _mm256_set_epi16(14168, 30053, 17869, 1339, 11657, -12932, 17751, 18770, 3515, -10677, -20936, 6050, 23398, -30363, 18194, -3800), _mm256_set_epi16(-3004, -4156, 4630, -3611, -1454, -1197, -1562, -1408, -2170, -456, 5608, -2430, 1478, 6216, -4968, 519), _mm256_set_epi16(-14788, -20459, 22792, -17776, -7158, -5892, -7689, -6931, -10682, -2245, 27607, -11962, 7276, 30600, -24456, 2555)];
    let l7:[__m256i;8] = [_mm256_set_epi16(-1969, 3345, 5039, 2401, 694, -225, -3152, 3523, 2935, 3904, 275, 3042, 5303, 5893, -4787, 3336), _mm256_set_epi16(-9693, 16466, 24806, 11819, 3416, -1108, -15516, 17343, 14448, 19218, 1354, 14975, 26105, 29010, -23565, 16422), _mm256_set_epi16(-2108, -2335, -4612, 6253, 5983, 4798, -1123, 3650, 1611, -4556, -4385, 631, 3065, 2712, -3063, 4657), _mm256_set_epi16(-10377, -11495, -22704, 30782, 29453, 23619, -5528, 17968, 7930, -22428, -21586, 3106, 15088, 13350, -15078, 22925), _mm256_set_epi16(2600, 2610, 3718, 5336, -2018, -5078, -6488, -460, -3048, 4331, -3248, 6194, 5675, 743, 2386, 5365), _mm256_set_epi16(12799, 12848, 18303, 26268, -9934, -24998, -31939, -2264, -15004, 21320, -15989, 30491, 27936, 3658, 11746, 26410), _mm256_set_epi16(5150, 5583, 708, 5449, -1437, 5450, 3534, 1137, -917, -894, -735, -492, -280, 5312, 3190, -382), _mm256_set_epi16(25352, 27483, 3485, 26824, -7074, 26829, 17397, 5597, -4514, -4401, -3618, -2422, -1378, 26149, 15703, -1880)];
    let l8:[__m256i;16] = [_mm256_set_epi16(5121, -3196, 3489, -49, 3625, 3870, -5857, 4282, 2288, -1600, -4200, 5730, 5405, -407, 2909, -2518), _mm256_set_epi16(25209, -15733, 17175, -241, 17845, 19051, -28832, 21079, 11263, -7876, -20675, 28207, 26607, -2004, 14320, -12395), _mm256_set_epi16(3231, 838, -5122, -671, -3340, -15, -6576, 223, -4532, 97, 5247, 597, 3375, -1498, 4994, -2693), _mm256_set_epi16(15905, 4125, -25214, -3303, -16442, -74, -32372, 1098, -22310, 478, 25829, 2939, 16614, -7374, 24584, -13257), _mm256_set_epi16(4225, 3943, 4242, -4456, -2427, -4801, 1615, 174, -4125, -1775, -6036, 3290, -1872, 6413, 2628, -4293), _mm256_set_epi16(20798, 19410, 20882, -21936, -11947, -23634, 7950, 857, -20306, -8738, -29713, 16196, -9215, 31569, 12937, -21133), _mm256_set_epi16(1616, 5506, -2770, -4730, -455, 549, -3967, 4953, -790, 5308, -333, 3212, -3708, 3742, 939, 2615), _mm256_set_epi16(7955, 27104, -13636, -23284, -2240, 2703, -19528, 24382, -3889, 26130, -1639, 15812, -18253, 18421, 4622, 12873), _mm256_set_epi16(2885, -4816, 6473, 5358, -4407, 6259, -3798, -4781, 5691, -5781, -4796, -5240, 3644, -3532, 3077, -604), _mm256_set_epi16(14202, -23708, 31865, 26376, -21694, 30811, -18696, -23535, 28015, -28458, -23609, -25795, 17938, -17387, 15147, -2973), _mm256_set_epi16(-1198, 4419, 5909, 2188, -5401, -3949, -5278, -4611, -3848, 442, -741, 6006, -5071, -5972, 4914, 3924), _mm256_set_epi16(-5897, 21753, 29088, 10771, -26588, -19440, -25982, -22699, -18943, 2176, -3648, 29566, -24963, -29398, 24190, 19317), _mm256_set_epi16(4080, -534, -5924, -5528, -4681, -5421, -1195, -6344, -281, -2461, -198, -5402, -3446, -242, 3867, 162), _mm256_set_epi16(20085, -2629, -29162, -27213, -23043, -26686, -5883, -31230, -1383, -12115, -975, -26592, -16964, -1191, 19036, 797), _mm256_set_epi16(913, -4642, -2603, -1733, 3785, 753, 2111, 747, -5933, 4086, 2168, -4149, 2903, -4129, -789, 1857), _mm256_set_epi16(4494, -22851, -12814, -8531, 18632, 3707, 10392, 3677, -29206, 20114, 10672, -20424, 14291, -20326, -3884, 9141)];

    // inverse Layer 8
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_13313(a[2*i], a[2*i+1], l8[2*i], l8[2*i+1]);
    }
    // inverse Layer 7
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_ibutterfly_13313(a0[i*4+j], a0[i*4+j+2], l7[2*i], l7[2*i+1]);
        }
    }
    // inverse Layer 6
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_ibutterfly_13313(a1[i], a1[i+4], l6[0], l6[1]); 
        [a0[i+8], a0[i+12]] = barrett_ibutterfly_13313(a1[i+8], a1[i+12], l6[2], l6[3]);
    }
    // inverse Layer 5
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_ibutterfly_13313(a0[i], a0[i+8], l5[0], l5[1]); 
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt_15361(s0: [__m256i;16]) -> [__m256i;16]{
    let s1 = intt5678_15361(s0);
    let s2 = transpose(s1);
    let s3 = intt1234_15361(s2);
    s3
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt1234_15361(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l1 ~ l4
    let l1:[__m256i;2] = [_mm256_set1_epi16(-3968), _mm256_set1_epi16(-16929)];
    let l2:[__m256i;4] = [_mm256_set1_epi16(4309), _mm256_set1_epi16(18384), _mm256_set1_epi16(1319), _mm256_set1_epi16(5627)];
    let l3:[__m256i;8] = [_mm256_set1_epi16(3261), _mm256_set1_epi16(13913), _mm256_set1_epi16(-5686), _mm256_set1_epi16(-24259), _mm256_set1_epi16(179), _mm256_set1_epi16(764), _mm256_set1_epi16(-3666), _mm256_set1_epi16(-15641)];
    let l4:[__m256i;16] = [_mm256_set1_epi16(6372), _mm256_set1_epi16(27185), _mm256_set1_epi16(-110), _mm256_set1_epi16(-469), _mm256_set1_epi16(-6841), _mm256_set1_epi16(-29186), _mm256_set1_epi16(-2201), _mm256_set1_epi16(-9390), _mm256_set1_epi16(3874), _mm256_set1_epi16(16528), _mm256_set1_epi16(-4329), _mm256_set1_epi16(-18469), _mm256_set1_epi16(-4341), _mm256_set1_epi16(-18520), _mm256_set1_epi16(-5407), _mm256_set1_epi16(-23068)];

    // inverse Layer 4
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_15361(a[2*i], a[2*i+1], l4[2*i], l4[2*i+1]);
    }
    // inverse Layer 3
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_ibutterfly_15361(a0[i*4+j], a0[i*4+j+2], l3[2*i], l3[2*i+1]);
        }
    }
    // inverse Layer 2
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_ibutterfly_15361(a1[i], a1[i+4], l2[0], l2[1]); 
        [a0[i+8], a0[i+12]] = barrett_ibutterfly_15361(a1[i+8], a1[i+12], l2[2], l2[3]);
    }
    // inverse Layer 1
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_ibutterfly_15361(a0[i], a0[i+8], l1[0], l1[1]); 
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt5678_15361(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l5 ~ l8
    let l5:[__m256i;2] = [_mm256_set_epi16(5992, 2572, -2313, -7467, -2702, 442, 720, 186, -1403, -6422, 6707, 7237, 2537, -5361, 5099, 2395), _mm256_set_epi16(25564, 10973, -9868, -31857, -11528, 1886, 3072, 794, -5986, -27399, 28615, 30876, 10824, -22872, 21754, 10218)];
    let l6:[__m256i;4] = [_mm256_set_epi16(1535, 6276, 2051, 1733, 1883, -4805, -3937, -5989, -7399, -5046, 3992, 2792, -6349, -100, -2064, -3519), _mm256_set_epi16(6549, 26776, 8750, 7394, 8034, -20500, -16797, -25551, -31567, -21528, 17031, 11912, -27087, -427, -8806, -15013), _mm256_set_epi16(7437, -2987, -2962, -5184, -6298, 3239, -121, 885, 4361, 7145, -3065, 3375, 792, 2586, -2539, 243), _mm256_set_epi16(31729, -12744, -12637, -22117, -26870, 13819, -516, 3776, 18606, 30483, -13076, 14399, 3379, 11033, -10832, 1037)];
    let l7:[__m256i;8] = [_mm256_set_epi16(-1000, -2430, 2473, 2802, -1668, -6713, -1316, -5757, 4907, 2776, -7592, -3702, -1790, 6403, -7374, -1100), _mm256_set_epi16(-4266, -10367, 10551, 11954, -7116, -28640, -5615, -24562, 20935, 11843, -32390, -15794, -7637, 27318, -31460, -4693), _mm256_set_epi16(4862, -4468, -2815, 3028, -1967, -1210, -852, -1969, -6772, 1331, -2135, 4420, -5938, -10, -2673, -2276), _mm256_set_epi16(20743, -19062, -12010, 12919, -8392, -5162, -3635, -8401, -28892, 5679, -9109, 18857, -25334, -43, -11404, -9710), _mm256_set_epi16(-7441, -5332, 5355, -6163, -1536, 1554, 2435, 1102, 7527, 4435, -5002, -1860, 1888, -2993, 2793, 6649), _mm256_set_epi16(-31746, -22748, 22847, -26294, -6553, 6630, 10389, 4702, 32113, 18921, -21340, -7935, 8055, -12769, 11916, 28367), _mm256_set_epi16(2046, -5279, 4377, 72, 3469, 6511, 11, -5149, 5352, -5626, -1524, 7200, 4584, -2171, 7343, -6966), _mm256_set_epi16(8729, -22522, 18674, 307, 14800, 27778, 47, -21968, 22834, -24003, -6502, 30718, 19557, -9262, 31328, -29720)];
    let l8:[__m256i;16] = [_mm256_set_epi16(-867, 3503, -6396, -7599, -445, 3498, -4373, -98, 469, -4308, -1902, 7251, 1006, -2222, -1794, 6440), _mm256_set_epi16(-3699, 14945, -27288, -32420, -1899, 14924, -18657, -418, 2001, -18380, -8115, 30936, 4292, -9480, -7654, 27476), _mm256_set_epi16(608, -1801, -2956, -811, -755, 6280, 5866, 4839, 2311, 2649, 4885, -815, 2052, 318, 6449, 6784), _mm256_set_epi16(2594, -7684, -12611, -3460, -3221, 26793, 25027, 20645, 9860, 11302, 20841, -3477, 8755, 1357, 27514, 28943), _mm256_set_epi16(3180, -5436, 3135, -5561, 2620, 5562, 4690, 6374, 4171, 1318, -4895, 285, 5868, 4695, 3763, 273), _mm256_set_epi16(13567, -23192, 13375, -23725, 11178, 23730, 20009, 27194, 17795, 5623, -20884, 1216, 25035, 20031, 16054, 1165), _mm256_set_epi16(6859, -3204, 2730, -7652, -3237, 3741, -7612, 7535, 6731, 7084, -7056, 5834, 3052, -3133, -692, -7367), _mm256_set_epi16(29263, -13670, 11647, -32646, -13810, 15961, -32476, 32147, 28717, 30223, -30104, 24890, 13021, -13367, -2952, -31430), _mm256_set_epi16(1119, -5159, 7191, 6908, -4295, 2867, -4581, -3003, -6691, -5507, -628, -7636, 5824, -1648, -2296, -2353), _mm256_set_epi16(4774, -22010, 30680, 29472, -18324, 12232, -19544, -12812, -28546, -23495, -2679, -32578, 24847, -7031, -9796, -10039), _mm256_set_epi16(-863, 5301, 6850, 6920, 7211, 6245, -5345, 4232, -6080, -6927, -3422, 7605, 6688, -4522, -1455, 2784), _mm256_set_epi16(-3682, 22616, 29225, 29523, 30765, 26644, -22804, 18055, -25940, -29553, -14600, 32446, 28534, -19293, -6208, 11878), _mm256_set_epi16(-1583, -202, -7192, 3046, -3104, -2767, -5466, 2181, -7146, 2020, 1162, -262, -4258, -7550, -2307, -685), _mm256_set_epi16(-6754, -862, -30684, 12995, -13243, -11805, -23320, 9305, -30488, 8618, 4958, -1118, -18166, -32211, -9843, -2922), _mm256_set_epi16(1305, -2764, 2882, 2579, 2850, 3659, -644, -5965, -1078, 3082, -2516, 4932, 1356, 4450, -980, 817), _mm256_set_epi16(5568, -11792, 12296, 11003, 12159, 15611, -2748, -25449, -4599, 13149, -10734, 21042, 5785, 18985, -4181, 3486)];

    // inverse Layer 8
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_15361(a[2*i], a[2*i+1], l8[2*i], l8[2*i+1]);
    }
    // inverse Layer 7
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_ibutterfly_15361(a0[i*4+j], a0[i*4+j+2], l7[2*i], l7[2*i+1]);
        }
    }
    // inverse Layer 6
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_ibutterfly_15361(a1[i], a1[i+4], l6[0], l6[1]); 
        [a0[i+8], a0[i+12]] = barrett_ibutterfly_15361(a1[i+8], a1[i+12], l6[2], l6[3]);
    }
    // inverse Layer 5
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_ibutterfly_15361(a0[i], a0[i+8], l5[0], l5[1]); 
    }
    a1
}