#[cfg(target_arch = "x86_64")]
use std::arch::x86_64::*;
use crate::field::fields::*;
use crate::NTT::transpose::*;

#[target_feature(enable = "avx2")]
pub unsafe fn intt_7681(s0: [__m256i;16]) -> [__m256i;16]{
    let s1 = intt5678_7681(s0);
    let s2 = transpose(s1);
    let s3 = intt1234_7681(s2);
    s3
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt1234_7681(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l1 ~ l4
    let l1:[__m256i;2] = [_mm256_set1_epi16(3383), _mm256_set1_epi16(28865)];
    let l2:[__m256i;4] = [_mm256_set1_epi16(1213), _mm256_set1_epi16(10350), _mm256_set1_epi16(1925), _mm256_set1_epi16(16425)];
    let l3:[__m256i;8] = [_mm256_set1_epi16(583), _mm256_set1_epi16(4974), _mm256_set1_epi16(1728), _mm256_set1_epi16(14744), _mm256_set1_epi16(527), _mm256_set1_epi16(4496), _mm256_set1_epi16(849), _mm256_set1_epi16(7244)];
    let l4:[__m256i;16] = [_mm256_set1_epi16(2784), _mm256_set1_epi16(23754), _mm256_set1_epi16(1366), _mm256_set1_epi16(11655), _mm256_set1_epi16(5543), _mm256_set1_epi16(47294), _mm256_set1_epi16(2648), _mm256_set1_epi16(22593), _mm256_set1_epi16(2381), _mm256_set1_epi16(20315), _mm256_set1_epi16(2446), _mm256_set1_epi16(20870), _mm256_set1_epi16(7584), _mm256_set1_epi16(64708), _mm256_set1_epi16(2132), _mm256_set1_epi16(18191)];

    // inverse Layer 4
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_7681(a[2*i], a[2*i+1], l4[2*i], l4[2*i+1]);
    }
    // inverse Layer 3
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_7681(a0[i*4+j], a0[i*4+j+2], l3[2*i], l3[2*i+1]);
        }
    }
    // inverse Layer 2
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_7681(a1[i], a1[i+4], l2[0], l2[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_7681(a1[i+8], a1[i+12], l2[2], l2[3]);
    }
    // inverse Layer 1
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_7681(a0[i], a0[i+8], l1[0], l1[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt5678_7681(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l5 ~ l8
    let l5:[__m256i;2] = [_mm256_set_epi16(5835, 365, 4928, 4027, 5036, 330, 2273, 878, 4681, 2399, 6569, 5887, 5413, 675, 3092), _mm256_set_epi16(49786, 3114, 42047, 34359, 42968, 2816, 19394, 7491, 39939, 20469, 56048, 50229, 46185, 5759, 26382)];
    let l6:[__m256i;4] = [_mm256_set_epi16(6915, 2881, 243, 7479, 2516, 6601, 5130, 4270, 528, 4232, 2508, 2941, 1655, 7097, 4907), _mm256_set_epi16(59000, 24581, 2073, 63812, 21467, 56321, 43770, 36433, 4505, 36108, 21399, 25093, 14121, 60553, 41868), _mm256_set_epi16(3074, 6949, 3477, 4601, 4301, 5212, 5967, 693, 5258, 1382, 1908, 2724, 1875, 6300, 6986), _mm256_set_epi16(26228, 59290, 29667, 39257, 36697, 44470, 50912, 5913, 44862, 11792, 16279, 23242, 15998, 53753, 59606)];
    let l7:[__m256i;8] = [_mm256_set_epi16(2044, 1952, 2028, 6090, 1097, 1228, 5833, 550, 5000, 1438, 6974, 4691, 2593, 7264, 3901), _mm256_set_epi16(17440, 16655, 17303, 51961, 9360, 10478, 49768, 4693, 42661, 12269, 59504, 40025, 22124, 61978, 33284), _mm256_set_epi16(6273, 1044, 4959, 993, 3041, 2844, 5828, 1003, 1415, 5999, 4149, 4801, 4582, 648, 4603), _mm256_set_epi16(53523, 8908, 42311, 8472, 25946, 24266, 49726, 8558, 12073, 51185, 35400, 40963, 39095, 5529, 39274), _mm256_set_epi16(6812, 1996, 1800, 1633, 3837, 319, 4784, 405, 4180, 219, 4493, 6801, 5618, 2900, 198), _mm256_set_epi16(58121, 17030, 15358, 13933, 32738, 2722, 40818, 3456, 35665, 1869, 38335, 58028, 47934, 24743, 1689), _mm256_set_epi16(4862, 3125, 3789, 6279, 3180, 3141, 1478, 7424, 3073, 4115, 2264, 6526, 5118, 6461, 2573), _mm256_set_epi16(41484, 26663, 32329, 53574, 27132, 26800, 12611, 63343, 26220, 35110, 19317, 55681, 43668, 55127, 21953)];
    let l8:[__m256i;16] = [_mm256_set_epi16(2805, 3280, 7563, 218, 329, 6943, 3483, 335, 113, 5910, 6492, 5224, 3765, 5784, 4442), _mm256_set_epi16(23933, 27986, 64529, 1860, 2807, 59239, 29718, 2858, 964, 50425, 55391, 44572, 32124, 49350, 37900), _mm256_set_epi16(1036, 5429, 2760, 3016, 4870, 535, 7060, 3751, 1115, 7007, 4305, 7042, 5809, 3832, 1211), _mm256_set_epi16(8839, 46321, 23549, 25733, 41552, 4565, 60237, 32004, 9513, 59785, 36731, 60084, 49564, 32695, 10333), _mm256_set_epi16(5964, 5906, 6511, 2395, 6024, 1499, 2481, 2110, 536, 572, 5135, 4964, 1725, 1885, 5248), _mm256_set_epi16(50886, 50391, 55553, 20435, 51398, 12790, 21168, 18003, 4573, 4880, 43813, 42354, 14718, 16083, 44777), _mm256_set_epi16(3137, 5010, 4595, 6222, 1784, 5687, 793, 2050, 111, 856, 1393, 3615, 5614, 4730, 4416), _mm256_set_epi16(26766, 42746, 39206, 53087, 15221, 48523, 6766, 17491, 947, 7304, 11885, 30844, 47900, 40357, 37678), _mm256_set_epi16(185, 3694, 4882, 1656, 321, 2922, 4236, 2358, 7012, 5013, 2583, 4992, 3882, 5977, 7268), _mm256_set_epi16(1578, 31518, 41654, 14129, 2739, 24931, 36142, 20119, 59828, 42772, 22039, 42593, 33122, 50997, 62012), _mm256_set_epi16(2875, 5702, 4055, 201, 1683, 5713, 1667, 1607, 62, 5322, 6077, 4135, 2259, 7283, 1129), _mm256_set_epi16(24530, 48651, 34598, 1715, 14360, 48745, 14223, 13711, 529, 45408, 51850, 35281, 19274, 62140, 9633), _mm256_set_epi16(4685, 3452, 1035, 1131, 4287, 6488, 94, 3081, 506, 1065, 702, 6244, 6415, 4561, 542), _mm256_set_epi16(39973, 29453, 8831, 9650, 36578, 55357, 802, 26288, 4317, 9087, 5990, 53275, 54734, 38915, 4624), _mm256_set_epi16(6275, 1959, 2838, 296, 5309, 5512, 4095, 3139, 346, 3006, 2757, 2197, 5679, 5805, 5669), _mm256_set_epi16(53540, 16715, 24214, 2526, 45298, 47030, 34939, 26783, 2952, 25648, 23523, 18745, 48454, 49530, 48369)];

    // inverse Layer 8
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_7681(a[2*i], a[2*i+1], l8[2*i], l8[2*i+1]);
    }
    // inverse Layer 7
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_7681(a0[i*4+j], a0[i*4+j+2], l7[2*i], l7[2*i+1]);
        }
    }
    // inverse Layer 6
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_7681(a1[i], a1[i+4], l6[0], l6[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_7681(a1[i+8], a1[i+12], l6[2], l6[3]);
    }
    // inverse Layer 5
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_7681(a0[i], a0[i+8], l5[0], l5[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt_10753(s0: [__m256i;16]) -> [__m256i;16]{
    let s1 = intt5678_10753(s0);
    let s2 = transpose(s1);
    let s3 = intt1234_10753(s2);
    s3
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt1234_10753(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l1 ~ l4
    let l1:[__m256i;2] = [_mm256_set1_epi16(4489), _mm256_set1_epi16(27359)];
    let l2:[__m256i;4] = [_mm256_set1_epi16(321), _mm256_set1_epi16(1956), _mm256_set1_epi16(67), _mm256_set1_epi16(408)];
    let l3:[__m256i;8] = [_mm256_set1_epi16(3422), _mm256_set1_epi16(20856), _mm256_set1_epi16(4679), _mm256_set1_epi16(28517), _mm256_set1_epi16(1656), _mm256_set1_epi16(10093), _mm256_set1_epi16(3461), _mm256_set1_epi16(21094)];
    let l4:[__m256i;16] = [_mm256_set1_epi16(2640), _mm256_set1_epi16(16090), _mm256_set1_epi16(9599), _mm256_set1_epi16(58503), _mm256_set1_epi16(5921), _mm256_set1_epi16(36087), _mm256_set1_epi16(2047), _mm256_set1_epi16(12476), _mm256_set1_epi16(1560), _mm256_set1_epi16(9508), _mm256_set1_epi16(8116), _mm256_set1_epi16(49464), _mm256_set1_epi16(6122), _mm256_set1_epi16(37312), _mm256_set1_epi16(3010), _mm256_set1_epi16(18345)];

    // inverse Layer 4
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_10753(a[2*i], a[2*i+1], l4[2*i], l4[2*i+1]);
    }
    // inverse Layer 3
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_10753(a0[i*4+j], a0[i*4+j+2], l3[2*i], l3[2*i+1]);
        }
    }
    // inverse Layer 2
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_10753(a1[i], a1[i+4], l2[0], l2[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_10753(a1[i+8], a1[i+12], l2[2], l2[3]);
    }
    // inverse Layer 1
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_10753(a0[i], a0[i+8], l1[0], l1[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt5678_10753(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l5 ~ l8
    let l5:[__m256i;2] = [_mm256_set_epi16(1186, 1219, 6402, 4191, 6970, 7853, 10007, 6142, 136, 2417, 644, 9112, 8836, 7740, 8317), _mm256_set_epi16(7228, 7429, 39018, 25543, 42480, 47861, 60989, 37433, 829, 14731, 3925, 55535, 53853, 47173, 50689)];
    let l6:[__m256i;4] = [_mm256_set_epi16(2582, 1136, 9912, 946, 3902, 10194, 7391, 5559, 2599, 94, 2085, 4455, 8009, 5122, 9831), _mm256_set_epi16(15736, 6924, 60410, 5766, 23781, 62129, 45046, 33880, 15840, 573, 12707, 27152, 48812, 31217, 59917), _mm256_set_epi16(2353, 3171, 7109, 2603, 7041, 6771, 2031, 9368, 3314, 5147, 3775, 753, 3697, 6799, 10373), _mm256_set_epi16(14341, 19326, 43327, 15864, 42913, 41267, 12378, 57095, 20198, 31369, 23007, 4589, 22532, 41438, 63220)];
    let l7:[__m256i;8] = [_mm256_set_epi16(8925, 9400, 6126, 4193, 2830, 6176, 3944, 5575, 8829, 8576, 10625, 4683, 7896, 3256, 7661), _mm256_set_epi16(54395, 57290, 37336, 25555, 17248, 37641, 24037, 33978, 53810, 52268, 64756, 28541, 48124, 19844, 46691), _mm256_set_epi16(4098, 8292, 7161, 5012, 29, 1145, 1444, 1943, 2228, 1202, 9487, 5490, 5155, 10414, 1207), _mm256_set_epi16(24976, 50537, 43644, 30546, 177, 6978, 8801, 11842, 13579, 7326, 57820, 33460, 31418, 63470, 7356), _mm256_set_epi16(5232, 8857, 4305, 8749, 6700, 159, 10653, 8027, 10669, 721, 5458, 5628, 4825, 7870, 393), _mm256_set_epi16(31887, 53981, 26238, 53322, 40834, 969, 64927, 48922, 65024, 4394, 33265, 34301, 29407, 47965, 2395), _mm256_set_epi16(2847, 5619, 7948, 118, 216, 1854, 4818, 3719, 10436, 3617, 5773, 267, 1945, 331, 9474), _mm256_set_epi16(17352, 34246, 48440, 719, 1316, 11300, 29364, 22666, 63604, 22044, 35185, 1627, 11854, 2017, 57741)];
    let l8:[__m256i;16] = [_mm256_set_epi16(10056, 290, 3687, 2076, 7649, 8721, 7108, 3661, 8538, 7363, 8616, 1317, 1267, 9979, 9618), _mm256_set_epi16(61288, 1767, 22471, 12653, 46618, 53152, 43321, 22313, 52036, 44875, 52512, 8027, 7722, 60819, 58619), _mm256_set_epi16(2777, 3226, 3258, 1082, 8768, 3572, 3959, 7995, 9414, 156, 10452, 7064, 3818, 9473, 264), _mm256_set_epi16(16925, 19661, 19856, 6594, 53438, 21770, 24129, 48727, 57375, 951, 63702, 43053, 23269, 57735, 1609), _mm256_set_epi16(5168, 5822, 8593, 2966, 6964, 2425, 9573, 6544, 3170, 3911, 6788, 8083, 7443, 8697, 6710), _mm256_set_epi16(31497, 35483, 52372, 18077, 42443, 14780, 58344, 39884, 19320, 23836, 41371, 49263, 45363, 53005, 40895), _mm256_set_epi16(9913, 3543, 2515, 815, 6823, 3903, 5515, 7324, 9753, 5754, 2482, 9163, 1466, 38, 2546), _mm256_set_epi16(60416, 21593, 15328, 4967, 41584, 23788, 33612, 44637, 59441, 35069, 15127, 55845, 8935, 232, 15517), _mm256_set_epi16(9393, 8089, 6440, 5096, 2854, 4783, 2336, 8624, 7655, 7460, 5571, 3259, 9646, 1437, 10255), _mm256_set_epi16(57247, 49300, 39250, 31058, 17394, 29151, 14237, 52560, 46655, 45466, 33953, 19863, 58789, 8758, 62501), _mm256_set_epi16(3298, 8594, 5889, 4847, 9966, 4894, 5445, 9717, 3778, 8792, 4946, 8402, 10, 1878, 3210), _mm256_set_epi16(20100, 52378, 35892, 29541, 60739, 29827, 33185, 59222, 23026, 53584, 30144, 51207, 61, 11446, 19564), _mm256_set_epi16(549, 8729, 6572, 6229, 5892, 7561, 3097, 1196, 2295, 9872, 5491, 3223, 6811, 6953, 3472), _mm256_set_epi16(3346, 53200, 40054, 37964, 35910, 46082, 18875, 7289, 13987, 60167, 33466, 19643, 41511, 42376, 21161), _mm256_set_epi16(6439, 607, 1293, 2343, 1361, 8928, 5590, 6761, 1538, 10097, 6269, 9813, 1533, 283, 4819), _mm256_set_epi16(39244, 3699, 7880, 14280, 8295, 54413, 34069, 41206, 9374, 61538, 38207, 59807, 9343, 1725, 29370)];

    // inverse Layer 8
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_10753(a[2*i], a[2*i+1], l8[2*i], l8[2*i+1]);
    }
    // inverse Layer 7
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_10753(a0[i*4+j], a0[i*4+j+2], l7[2*i], l7[2*i+1]);
        }
    }
    // inverse Layer 6
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_10753(a1[i], a1[i+4], l6[0], l6[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_10753(a1[i+8], a1[i+12], l6[2], l6[3]);
    }
    // inverse Layer 5
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_10753(a0[i], a0[i+8], l5[0], l5[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt_11777(s0: [__m256i;16]) -> [__m256i;16]{
    let s1 = intt5678_11777(s0);
    let s2 = transpose(s1);
    let s3 = intt1234_11777(s2);
    s3
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt1234_11777(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l1 ~ l4
    let l1:[__m256i;2] = [_mm256_set1_epi16(5322), _mm256_set1_epi16(29616)];
    let l2:[__m256i;4] = [_mm256_set1_epi16(4201), _mm256_set1_epi16(23377), _mm256_set1_epi16(4976), _mm256_set1_epi16(27690)];
    let l3:[__m256i;8] = [_mm256_set1_epi16(9280), _mm256_set1_epi16(51641), _mm256_set1_epi16(7199), _mm256_set1_epi16(40061), _mm256_set1_epi16(8367), _mm256_set1_epi16(46560), _mm256_set1_epi16(11440), _mm256_set1_epi16(63661)];
    let l4:[__m256i;16] = [_mm256_set1_epi16(11484), _mm256_set1_epi16(63906), _mm256_set1_epi16(6995), _mm256_set1_epi16(38925), _mm256_set1_epi16(5692), _mm256_set1_epi16(31675), _mm256_set1_epi16(2380), _mm256_set1_epi16(13244), _mm256_set1_epi16(10553), _mm256_set1_epi16(58725), _mm256_set1_epi16(10330), _mm256_set1_epi16(57484), _mm256_set1_epi16(1915), _mm256_set1_epi16(10656), _mm256_set1_epi16(4525), _mm256_set1_epi16(25180)];

    // inverse Layer 4
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_11777(a[2*i], a[2*i+1], l4[2*i], l4[2*i+1]);
    }
    // inverse Layer 3
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_11777(a0[i*4+j], a0[i*4+j+2], l3[2*i], l3[2*i+1]);
        }
    }
    // inverse Layer 2
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_11777(a1[i], a1[i+4], l2[0], l2[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_11777(a1[i+8], a1[i+12], l2[2], l2[3]);
    }
    // inverse Layer 1
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_11777(a0[i], a0[i+8], l1[0], l1[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt5678_11777(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l5 ~ l8
    let l5:[__m256i;2] = [_mm256_set_epi16(8190, 503, 6757, 5573, 7629, 5558, 7144, 4212, 8509, 2333, 9308, 3114, 2838, 6055, 1265), _mm256_set_epi16(45575, 2799, 37601, 31012, 42453, 30929, 39755, 23439, 47350, 12983, 51797, 17329, 15793, 33695, 7039)];
    let l6:[__m256i;4] = [_mm256_set_epi16(8098, 6264, 6531, 7722, 1352, 11374, 8892, 3238, 9917, 5537, 5709, 10415, 4282, 11468, 9138), _mm256_set_epi16(45063, 34858, 36343, 42971, 7524, 63293, 49482, 18019, 55186, 30812, 31769, 57957, 23828, 63816, 50851), _mm256_set_epi16(8767, 2500, 9193, 3488, 11087, 9533, 6333, 10229, 6580, 6038, 1961, 9757, 9451, 1345, 9162), _mm256_set_epi16(48786, 13912, 51157, 19410, 61696, 53049, 35242, 56922, 36616, 33600, 10912, 54295, 52592, 7485, 50984)];
    let l7:[__m256i;8] = [_mm256_set_epi16(7943, 6784, 11021, 4302, 3412, 10307, 4322, 10574, 10946, 5570, 6738, 10448, 11430, 9522, 2601), _mm256_set_epi16(44201, 37751, 61329, 23940, 18987, 57356, 24051, 58842, 60912, 30996, 37495, 58140, 63605, 52988, 14474), _mm256_set_epi16(2403, 1056, 2114, 3673, 5979, 1216, 2562, 2802, 3404, 8715, 8799, 8851, 2541, 3206, 7295), _mm256_set_epi16(13372, 5876, 11764, 20439, 33272, 6767, 14257, 15592, 18942, 48497, 48964, 49254, 14140, 17841, 40595), _mm256_set_epi16(6097, 2599, 10299, 10657, 7412, 5491, 11201, 8325, 7029, 4586, 3890, 10391, 7779, 8094, 9082), _mm256_set_epi16(33928, 14463, 57311, 59303, 41246, 30556, 62331, 46327, 39115, 25520, 21647, 57823, 43288, 45041, 50539), _mm256_set_epi16(9841, 10294, 4771, 11727, 5073, 5622, 6640, 4697, 2315, 1688, 2487, 1534, 1230, 9825, 3560), _mm256_set_epi16(54763, 57283, 26549, 65258, 28230, 31285, 36950, 26138, 12882, 9393, 13840, 8536, 6845, 54674, 19810)];
    let l8:[__m256i;16] = [_mm256_set_epi16(8328, 4765, 3135, 3539, 7644, 3610, 3166, 3435, 9715, 2200, 5410, 2745, 551, 51, 5318), _mm256_set_epi16(46343, 26516, 17445, 19694, 42537, 20089, 17618, 19115, 54061, 12242, 30105, 15275, 3066, 284, 29593), _mm256_set_epi16(9174, 8363, 6147, 2172, 1790, 10564, 3628, 5713, 810, 11339, 2826, 743, 10202, 3074, 9678), _mm256_set_epi16(51051, 46538, 34206, 12087, 9961, 58786, 20189, 31791, 4507, 63099, 15726, 4135, 56772, 17106, 53856), _mm256_set_epi16(3001, 10067, 5811, 260, 6596, 8452, 10292, 803, 261, 644, 3266, 10577, 3982, 5381, 5042), _mm256_set_epi16(16700, 56020, 32337, 1447, 36705, 47033, 57272, 4468, 1452, 3584, 18174, 58858, 22159, 29944, 28057), _mm256_set_epi16(2047, 409, 9540, 1233, 8286, 5004, 141, 8451, 5795, 8804, 10041, 5824, 9710, 10921, 7959), _mm256_set_epi16(11391, 2276, 53088, 6861, 46109, 27846, 785, 47028, 32248, 48992, 55876, 32409, 54034, 60773, 44290), _mm256_set_epi16(4205, 9067, 8128, 295, 5336, 7932, 5199, 4905, 4007, 8884, 7703, 11406, 6806, 4520, 3996), _mm256_set_epi16(23400, 50456, 45230, 1642, 29693, 44140, 28931, 27295, 22298, 49437, 42865, 63471, 37874, 25153, 22237), _mm256_set_epi16(4716, 1765, 4745, 3002, 5822, 603, 2607, 10629, 1043, 7898, 3689, 599, 24, 1819, 1654), _mm256_set_epi16(26243, 9822, 26405, 16705, 32398, 3356, 14507, 59148, 5804, 43950, 20528, 3333, 134, 10122, 9204), _mm256_set_epi16(3341, 9309, 7469, 2643, 7102, 4451, 4361, 3225, 8134, 3104, 9012, 5857, 10355, 7050, 8894), _mm256_set_epi16(18592, 51802, 41563, 14708, 39521, 24769, 24268, 17946, 45264, 17273, 50149, 32593, 57623, 39231, 49493), _mm256_set_epi16(44, 10405, 8189, 6958, 3061, 8726, 1223, 3875, 1821, 10668, 4783, 5029, 1578, 1115, 1273), _mm256_set_epi16(245, 57901, 45570, 38719, 17034, 48558, 6806, 21563, 10133, 59365, 26616, 27985, 8781, 6205, 7084)];

    // inverse Layer 8
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_11777(a[2*i], a[2*i+1], l8[2*i], l8[2*i+1]);
    }
    // inverse Layer 7
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_11777(a0[i*4+j], a0[i*4+j+2], l7[2*i], l7[2*i+1]);
        }
    }
    // inverse Layer 6
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_11777(a1[i], a1[i+4], l6[0], l6[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_11777(a1[i+8], a1[i+12], l6[2], l6[3]);
    }
    // inverse Layer 5
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_11777(a0[i], a0[i+8], l5[0], l5[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt_12289(s0: [__m256i;16]) -> [__m256i;16]{
    let s1 = intt5678_12289(s0);
    let s2 = transpose(s1);
    let s3 = intt1234_12289(s2);
    s3
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt1234_12289(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l1 ~ l4
    let l1:[__m256i;2] = [_mm256_set1_epi16(1479), _mm256_set1_epi16(7887)];
    let l2:[__m256i;4] = [_mm256_set1_epi16(5146), _mm256_set1_epi16(27443), _mm256_set1_epi16(4043), _mm256_set1_epi16(21561)];
    let l3:[__m256i;8] = [_mm256_set1_epi16(6553), _mm256_set1_epi16(34946), _mm256_set1_epi16(8155), _mm256_set1_epi16(43490), _mm256_set1_epi16(11567), _mm256_set1_epi16(61686), _mm256_set1_epi16(10984), _mm256_set1_epi16(58577)];
    let l4:[__m256i;16] = [_mm256_set1_epi16(2545), _mm256_set1_epi16(13572), _mm256_set1_epi16(3621), _mm256_set1_epi16(19310), _mm256_set1_epi16(3504), _mm256_set1_epi16(18686), _mm256_set1_epi16(8747), _mm256_set1_epi16(46647), _mm256_set1_epi16(1646), _mm256_set1_epi16(8778), _mm256_set1_epi16(1212), _mm256_set1_epi16(6463), _mm256_set1_epi16(6429), _mm256_set1_epi16(34285), _mm256_set1_epi16(3195), _mm256_set1_epi16(17039)];

    // inverse Layer 4
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_12289(a[2*i], a[2*i+1], l4[2*i], l4[2*i+1]);
    }
    // inverse Layer 3
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_12289(a0[i*4+j], a0[i*4+j+2], l3[2*i], l3[2*i+1]);
        }
    }
    // inverse Layer 2
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_12289(a1[i], a1[i+4], l2[0], l2[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_12289(a1[i+8], a1[i+12], l2[2], l2[3]);
    }
    // inverse Layer 1
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_12289(a0[i], a0[i+8], l1[0], l1[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt5678_12289(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l5 ~ l8
    let l5:[__m256i;2] = [_mm256_set_epi16(9664, 11340, 2639, 4821, 563, 2975, 2744, 9283, 1351, 4978, 6512, 8961, 5728, 7698, 5828), _mm256_set_epi16(51537, 60475, 14074, 25710, 3002, 15865, 14633, 49505, 7205, 26547, 34728, 47788, 30547, 41053, 31080)];
    let l6:[__m256i;4] = [_mm256_set_epi16(726, 7678, 12149, 10436, 9521, 1635, 4255, 11112, 12208, 3091, 1000, 7969, 9923, 9238, 7393), _mm256_set_epi16(3872, 40946, 64789, 55654, 50775, 8719, 22691, 59259, 65104, 16484, 5333, 42498, 52918, 49265, 39426), _mm256_set_epi16(3014, 9088, 10963, 5086, 11499, 11334, 2319, 11119, 7443, 9542, 9154, 3712, 11227, 2294, 8736), _mm256_set_epi16(16073, 48465, 58465, 27123, 61323, 60443, 12367, 59297, 39693, 50887, 48817, 19796, 59872, 12234, 46588)];
    let l7:[__m256i;8] = [_mm256_set_epi16(9, 1022, 480, 9447, 6498, 11745, 11950, 9821, 1381, 9764, 8705, 8112, 4989, 6958, 10616), _mm256_set_epi16(48, 5450, 2560, 50380, 34653, 62635, 63728, 52374, 7365, 52070, 46423, 43260, 26606, 37106, 56614), _mm256_set_epi16(9452, 5374, 12159, 7935, 3296, 8340, 9893, 7837, 5067, 2197, 9813, 12171, 11462, 6522, 8541), _mm256_set_epi16(50407, 28659, 64843, 42317, 17577, 44476, 52758, 41794, 27022, 11716, 52332, 64907, 61126, 34781, 45548), _mm256_set_epi16(8595, 5179, 8582, 10530, 11934, 3382, 8058, 2548, 3932, 2731, 4890, 6378, 6747, 12144, 8830), _mm256_set_epi16(45836, 27619, 45767, 56155, 63643, 18036, 42973, 13588, 20969, 14564, 26078, 34013, 35981, 64763, 47090), _mm256_set_epi16(9048, 11560, 3289, 2013, 10200, 7197, 9005, 9408, 10593, 1428, 11955, 9863, 7901, 1260, 6534), _mm256_set_epi16(48252, 61648, 17540, 10735, 54396, 38381, 48023, 50172, 56491, 7615, 63755, 52598, 42135, 6719, 34845)];
    let l8:[__m256i;16] = [_mm256_set_epi16(2780, 5195, 10805, 4895, 2645, 4053, 9984, 7247, 10115, 4372, 4414, 2847, 1689, 3364, 9018), _mm256_set_epi16(14825, 27704, 57622, 26105, 14106, 21614, 53244, 38648, 53942, 23315, 23539, 15183, 9007, 17940, 48092), _mm256_set_epi16(7852, 12286, 3149, 160, 7370, 12176, 8374, 10123, 10863, 7635, 10626, 10512, 6998, 9585, 4938), _mm256_set_epi16(41874, 65520, 16793, 853, 39303, 64933, 44658, 53985, 57931, 40717, 56667, 56059, 37320, 51116, 26334), _mm256_set_epi16(10040, 4048, 2884, 11136, 1630, 10163, 5407, 9103, 9919, 9424, 6957, 8779, 9320, 3978, 2686), _mm256_set_epi16(53542, 21588, 15380, 59387, 8693, 54198, 28835, 48545, 52897, 50257, 37101, 46818, 49703, 21214, 14324), _mm256_set_epi16(3985, 4905, 8758, 11813, 2178, 10745, 420, 5559, 7098, 3136, 9890, 3400, 9273, 12046, 3000), _mm256_set_epi16(21252, 26158, 46706, 62998, 11615, 57302, 2240, 29646, 37853, 16724, 52742, 18132, 49452, 64240, 15999), _mm256_set_epi16(5444, 2381, 11796, 8193, 7952, 11854, 10377, 10911, 9041, 1207, 11121, 7012, 11885, 7644, 11224), _mm256_set_epi16(29032, 12698, 62907, 43692, 42407, 63216, 55339, 58187, 48215, 6437, 59307, 37394, 63382, 40765, 59856), _mm256_set_epi16(5011, 11287, 5088, 4284, 11414, 8509, 1607, 4976, 2987, 6022, 8643, 2437, 2422, 6039, 9723), _mm256_set_epi16(26723, 60192, 27134, 22846, 60870, 45378, 8570, 26537, 15929, 32115, 46092, 12996, 12916, 32205, 51852), _mm256_set_epi16(2859, 11244, 9808, 5012, 2912, 5698, 11935, 7428, 5101, 1067, 11847, 9888, 3778, 3833, 11899), _mm256_set_epi16(15247, 59963, 52305, 26728, 15529, 30387, 63648, 39613, 27203, 5690, 63179, 52732, 20148, 20441, 63456), _mm256_set_epi16(8526, 1440, 12262, 3066, 1632, 7205, 7404, 1017, 11744, 5019, 3704, 9611, 7575, 8146, 10752), _mm256_set_epi16(45468, 7679, 65392, 16351, 8703, 38424, 39485, 5424, 62630, 26766, 19753, 51254, 40397, 43442, 57339)];

    // inverse Layer 8
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_12289(a[2*i], a[2*i+1], l8[2*i], l8[2*i+1]);
    }
    // inverse Layer 7
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_12289(a0[i*4+j], a0[i*4+j+2], l7[2*i], l7[2*i+1]);
        }
    }
    // inverse Layer 6
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_12289(a1[i], a1[i+4], l6[0], l6[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_12289(a1[i+8], a1[i+12], l6[2], l6[3]);
    }
    // inverse Layer 5
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_12289(a0[i], a0[i+8], l5[0], l5[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt_13313(s0: [__m256i;16]) -> [__m256i;16]{
    let s1 = intt5678_13313(s0);
    let s2 = transpose(s1);
    let s3 = intt1234_13313(s2);
    s3
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt1234_13313(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l1 ~ l4
    let l1:[__m256i;2] = [_mm256_set1_epi16(258), _mm256_set1_epi16(1270)];
    let l2:[__m256i;4] = [_mm256_set1_epi16(10687), _mm256_set1_epi16(52609), _mm256_set1_epi16(11858), _mm256_set1_epi16(58373)];
    let l3:[__m256i;8] = [_mm256_set1_epi16(8038), _mm256_set1_epi16(39569), _mm256_set1_epi16(3024), _mm256_set1_epi16(14886), _mm256_set1_epi16(6476), _mm256_set1_epi16(31879), _mm256_set1_epi16(6683), _mm256_set1_epi16(32898)];
    let l4:[__m256i;16] = [_mm256_set1_epi16(4196), _mm256_set1_epi16(20656), _mm256_set1_epi16(4215), _mm256_set1_epi16(20749), _mm256_set1_epi16(5487), _mm256_set1_epi16(27011), _mm256_set1_epi16(4468), _mm256_set1_epi16(21995), _mm256_set1_epi16(4690), _mm256_set1_epi16(23087), _mm256_set1_epi16(1463), _mm256_set1_epi16(7202), _mm256_set1_epi16(1415), _mm256_set1_epi16(6966), _mm256_set1_epi16(5619), _mm256_set1_epi16(27661)];

    // inverse Layer 4
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_13313(a[2*i], a[2*i+1], l4[2*i], l4[2*i+1]);
    }
    // inverse Layer 3
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_13313(a0[i*4+j], a0[i*4+j+2], l3[2*i], l3[2*i+1]);
        }
    }
    // inverse Layer 2
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_13313(a1[i], a1[i+4], l2[0], l2[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_13313(a1[i+8], a1[i+12], l2[2], l2[3]);
    }
    // inverse Layer 1
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_13313(a0[i], a0[i+8], l1[0], l1[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt5678_13313(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l5 ~ l8
    let l5:[__m256i;2] = [_mm256_set_epi16(12161, 8983, 1278, 10212, 3902, 5072, 8955, 6072, 2651, 4995, 9748, 1173, 2198, 7938, 10343), _mm256_set_epi16(59865, 44221, 6291, 50271, 19208, 24968, 44083, 29891, 13050, 24589, 47987, 5774, 10820, 39076, 50916)];
    let l6:[__m256i;4] = [_mm256_set_epi16(11859, 2368, 12116, 10686, 11751, 3606, 11905, 3813, 10309, 2878, 9157, 6105, 4630, 3630, 9702), _mm256_set_epi16(58378, 11657, 59644, 52604, 57847, 17751, 58605, 18770, 50748, 14168, 45077, 30053, 22792, 17869, 47760), _mm256_set_epi16(1478, 4753, 6216, 7145, 8345, 3696, 519, 12541, 11143, 714, 12857, 11144, 5608, 9060, 10883), _mm256_set_epi16(7276, 23398, 30600, 35173, 41080, 18194, 2555, 61736, 54854, 3515, 63291, 54859, 27607, 44600, 53574)];
    let l7:[__m256i;8] = [_mm256_set_epi16(5150, 2600, 11205, 11344, 5583, 2610, 10978, 3345, 708, 3718, 8701, 5039, 5449, 5336, 6253), _mm256_set_epi16(25352, 12799, 55159, 55843, 27483, 12848, 54041, 16466, 3485, 18303, 42832, 24806, 26824, 26268, 30782), _mm256_set_epi16(11876, 11295, 5983, 694, 5450, 8235, 4798, 13088, 3534, 6825, 12190, 10161, 1137, 12853, 3650), _mm256_set_epi16(58462, 55602, 29453, 3416, 26829, 40538, 23619, 64428, 17397, 33597, 60008, 50020, 5597, 63272, 17968), _mm256_set_epi16(12396, 10265, 1611, 2935, 12419, 4331, 8757, 3904, 12578, 10065, 8928, 275, 12821, 6194, 631), _mm256_set_epi16(61022, 50532, 7930, 14448, 61135, 21320, 43108, 19218, 61918, 49547, 43950, 1354, 63114, 30491, 3106), _mm256_set_epi16(13033, 5675, 3065, 5303, 5312, 743, 2712, 5893, 3190, 2386, 10250, 8526, 12931, 5365, 4657), _mm256_set_epi16(64158, 27936, 15088, 26105, 26149, 3658, 13350, 29010, 15703, 11746, 50458, 41971, 63656, 26410, 22925)];
    let l8:[__m256i;16] = [_mm256_set_epi16(10710, 7389, 5909, 6473, 10543, 4242, 8191, 3489, 11580, 7785, 2188, 5358, 8583, 8857, 12642), _mm256_set_epi16(52722, 36374, 29088, 31865, 51900, 20882, 40322, 17175, 57005, 38323, 10771, 26376, 42252, 43600, 62233), _mm256_set_epi16(913, 4080, 12115, 2885, 1616, 4225, 3231, 5121, 8671, 12779, 4419, 8497, 5506, 3943, 838), _mm256_set_epi16(4494, 20085, 59639, 14202, 7955, 20798, 15905, 25209, 42685, 62907, 21753, 41828, 27104, 19410, 4125), _mm256_set_epi16(2111, 12118, 8035, 9515, 9346, 1615, 6737, 7456, 747, 6969, 8702, 8532, 4953, 174, 223), _mm256_set_epi16(10392, 59653, 39554, 46840, 46008, 7950, 33164, 36704, 3677, 34306, 42837, 42001, 24382, 857, 1098), _mm256_set_epi16(3785, 8632, 7912, 8906, 12858, 10886, 9973, 3625, 753, 7892, 9364, 6259, 549, 8512, 13298), _mm256_set_epi16(18632, 42493, 38948, 43842, 63296, 53589, 49094, 17845, 3707, 38850, 46096, 30811, 2703, 41902, 65462), _mm256_set_epi16(2168, 13115, 12572, 8517, 12980, 7277, 5247, 9113, 9164, 7911, 6006, 8073, 3212, 3290, 597), _mm256_set_epi16(10672, 64561, 61888, 41927, 63897, 35823, 25829, 44861, 45112, 38944, 29566, 39741, 15812, 16196, 2939), _mm256_set_epi16(7380, 13032, 9465, 5691, 12523, 9188, 8781, 2288, 4086, 10852, 442, 7532, 5308, 11538, 97), _mm256_set_epi16(36330, 64153, 46593, 28015, 61647, 45230, 43226, 11263, 20114, 53421, 2176, 37078, 26130, 56798, 478), _mm256_set_epi16(12524, 3867, 4914, 3077, 939, 2628, 4994, 2909, 1857, 162, 3924, 12709, 2615, 9020, 10620), _mm256_set_epi16(61652, 19036, 24190, 15147, 4622, 12937, 24584, 14320, 9141, 797, 19317, 62563, 12873, 44403, 52279), _mm256_set_epi16(2903, 9867, 8242, 3644, 9605, 11441, 3375, 5405, 9184, 13071, 7341, 9781, 3742, 6413, 11815), _mm256_set_epi16(14291, 48572, 40573, 17938, 47283, 56321, 16614, 26607, 45210, 64345, 36138, 48149, 18421, 31569, 58162)];

    // inverse Layer 8
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_13313(a[2*i], a[2*i+1], l8[2*i], l8[2*i+1]);
    }
    // inverse Layer 7
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_13313(a0[i*4+j], a0[i*4+j+2], l7[2*i], l7[2*i+1]);
        }
    }
    // inverse Layer 6
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_13313(a1[i], a1[i+4], l6[0], l6[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_13313(a1[i+8], a1[i+12], l6[2], l6[3]);
    }
    // inverse Layer 5
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_13313(a0[i], a0[i+8], l5[0], l5[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt_15361(s0: [__m256i;16]) -> [__m256i;16]{
    let s1 = intt5678_15361(s0);
    let s2 = transpose(s1);
    let s3 = intt1234_15361(s2);
    s3
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt1234_15361(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l1 ~ l4
    let l1:[__m256i;2] = [_mm256_set1_epi16(3968), _mm256_set1_epi16(16929)];
    let l2:[__m256i;4] = [_mm256_set1_epi16(4309), _mm256_set1_epi16(18384), _mm256_set1_epi16(1319), _mm256_set1_epi16(5627)];
    let l3:[__m256i;8] = [_mm256_set1_epi16(179), _mm256_set1_epi16(764), _mm256_set1_epi16(11695), _mm256_set1_epi16(49895), _mm256_set1_epi16(3261), _mm256_set1_epi16(13913), _mm256_set1_epi16(9675), _mm256_set1_epi16(41277)];
    let l4:[__m256i;16] = [_mm256_set1_epi16(6372), _mm256_set1_epi16(27185), _mm256_set1_epi16(15251), _mm256_set1_epi16(65067), _mm256_set1_epi16(13160), _mm256_set1_epi16(56146), _mm256_set1_epi16(8520), _mm256_set1_epi16(36350), _mm256_set1_epi16(3874), _mm256_set1_epi16(16528), _mm256_set1_epi16(11032), _mm256_set1_epi16(47067), _mm256_set1_epi16(9954), _mm256_set1_epi16(42468), _mm256_set1_epi16(11020), _mm256_set1_epi16(47016)];

    // inverse Layer 4
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_15361(a[2*i], a[2*i+1], l4[2*i], l4[2*i+1]);
    }
    // inverse Layer 3
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_15361(a0[i*4+j], a0[i*4+j+2], l3[2*i], l3[2*i+1]);
        }
    }
    // inverse Layer 2
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_15361(a1[i], a1[i+4], l2[0], l2[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_15361(a1[i+8], a1[i+12], l2[2], l2[3]);
    }
    // inverse Layer 1
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_15361(a0[i], a0[i+8], l1[0], l1[1]);
    }
    a1
}

#[target_feature(enable = "avx2")]
pub unsafe fn intt5678_15361(a: [__m256i;16]) -> [__m256i;16]{
    let mut a0: [__m256i;16] = [_mm256_setzero_si256(); 16];
    let mut a1: [__m256i;16] = [_mm256_setzero_si256(); 16];
    // let l5 ~ l8
    let l5:[__m256i;2] = [_mm256_set_epi16(8939, 13958, 7237, 6707, 10000, 2537, 5099, 2395, 2572, 5992, 7894, 13048, 442, 12659, 720), _mm256_set_epi16(38137, 59550, 30876, 28615, 42664, 10824, 21754, 10218, 10973, 25564, 33679, 55668, 1886, 54008, 3072)];
    let l6:[__m256i;4] = [_mm256_set_epi16(12374, 6276, 7437, 1535, 10177, 1733, 12399, 2051, 3239, 10556, 9063, 1883, 15240, 11424, 885), _mm256_set_epi16(52792, 26776, 31729, 6549, 43419, 7394, 52899, 8750, 13819, 45036, 38666, 8034, 65020, 48739, 3776), _mm256_set_epi16(7145, 10315, 4361, 7962, 3375, 2792, 12296, 3992, 2586, 15261, 792, 9012, 12822, 13297, 243), _mm256_set_epi16(30483, 44008, 18606, 33969, 14399, 11912, 52460, 17031, 11033, 65109, 3379, 38449, 54704, 56730, 1037)];
    let l7:[__m256i;8] = [_mm256_set_epi16(6511, 1554, 14151, 8648, 3469, 13825, 13394, 13693, 11, 2435, 14509, 14045, 10212, 1102, 13392), _mm256_set_epi16(27778, 6630, 60374, 36896, 14800, 58983, 57144, 58420, 47, 10389, 61901, 59921, 43568, 4702, 57135), _mm256_set_epi16(10082, 10029, 10893, 12931, 2046, 7920, 4862, 14361, 72, 9198, 3028, 2802, 4377, 5355, 12546), _mm256_set_epi16(43014, 42788, 46474, 55169, 8729, 33790, 20743, 61270, 307, 39242, 12919, 11954, 18674, 22847, 53526), _mm256_set_epi16(13190, 12368, 15351, 6403, 4584, 1888, 9423, 13571, 7343, 2793, 12688, 7987, 8395, 6649, 13085), _mm256_set_epi16(56274, 52767, 65493, 27318, 19557, 8055, 40202, 57899, 31328, 11916, 54132, 34076, 35816, 28367, 55826), _mm256_set_epi16(9735, 4435, 1331, 2776, 5352, 7527, 8589, 4907, 7200, 13501, 4420, 11659, 13837, 10359, 13226), _mm256_set_epi16(41533, 18921, 5679, 11843, 22834, 32113, 36644, 20935, 30718, 57601, 18857, 49742, 59034, 44196, 56427)];
    let l8:[__m256i;16] = [_mm256_set_epi16(14717, 9895, 10016, 10780, 7749, 4690, 5866, 10988, 9396, 2181, 4232, 12358, 7535, 6374, 4839), _mm256_set_epi16(62788, 42216, 42732, 45992, 33060, 20009, 25027, 46879, 40087, 9305, 18055, 52724, 32147, 27194, 20645), _mm256_set_epi16(3659, 12594, 6245, 2867, 3741, 5562, 6280, 3498, 2850, 12257, 7211, 11066, 12124, 2620, 14606), _mm256_set_epi16(15611, 53731, 26644, 12232, 15961, 23730, 26793, 14924, 12159, 52293, 30765, 47212, 51726, 11178, 62315), _mm256_set_epi16(2579, 3046, 6920, 6908, 7709, 9800, 14550, 7762, 2882, 8169, 6850, 7191, 2730, 3135, 12405), _mm256_set_epi16(11003, 12995, 29523, 29472, 32890, 41811, 62076, 33116, 12296, 34852, 29225, 30680, 11647, 13375, 52925), _mm256_set_epi16(12597, 15159, 5301, 10202, 12157, 9925, 13560, 3503, 1305, 13778, 14498, 1119, 6859, 3180, 608), _mm256_set_epi16(53744, 64674, 22616, 43526, 51866, 42344, 57852, 14945, 5568, 58782, 61854, 4774, 29263, 13567, 2594), _mm256_set_epi16(14381, 13054, 13906, 13065, 14669, 3763, 6449, 13567, 817, 14676, 2784, 13008, 7994, 273, 6784), _mm256_set_epi16(61355, 55693, 59328, 55740, 62584, 16054, 27514, 57882, 3486, 62614, 11878, 55497, 34106, 1165, 28943), _mm256_set_epi16(4450, 7811, 10839, 13713, 12228, 4695, 318, 13139, 1356, 11103, 6688, 5824, 3052, 5868, 2052), _mm256_set_epi16(18985, 33325, 46243, 58505, 52169, 20031, 1357, 56056, 5785, 47370, 28534, 24847, 13021, 25035, 8755), _mm256_set_epi16(4932, 15099, 7605, 7725, 5834, 285, 14546, 7251, 12845, 1162, 11939, 14733, 8305, 10466, 4885), _mm256_set_epi16(21042, 64418, 32446, 32958, 24890, 1216, 62059, 30936, 54802, 4958, 50936, 62857, 35432, 44652, 20841), _mm256_set_epi16(3082, 2020, 8434, 9854, 7084, 1318, 2649, 11053, 14283, 8215, 9281, 8670, 6731, 4171, 2311), _mm256_set_epi16(13149, 8618, 35983, 42041, 30223, 5623, 11302, 47156, 60937, 35048, 39596, 36990, 28717, 17795, 9860)];

    // inverse Layer 8
    for i in 0..8{
        [a0[2*i], a0[2*i+1]] = barrett_ibutterfly_15361(a[2*i], a[2*i+1], l8[2*i], l8[2*i+1]);
    }
    // inverse Layer 7
    for i in 0..4{
        for j in 0..2{
            [a1[i*4+j], a1[i*4+j+2]] = barrett_butterfly_15361(a0[i*4+j], a0[i*4+j+2], l7[2*i], l7[2*i+1]);
        }
    }
    // inverse Layer 6
    for i in 0..4{
        [a0[i], a0[i+4]] = barrett_butterfly_15361(a1[i], a1[i+4], l6[0], l6[1]);
        [a0[i+8], a0[i+12]] = barrett_butterfly_15361(a1[i+8], a1[i+12], l6[2], l6[3]);
    }
    // inverse Layer 5
    for i in 0..8{
        [a1[i], a1[i+8]] = barrett_butterfly_15361(a0[i], a0[i+8], l5[0], l5[1]);
    }
    a1
}